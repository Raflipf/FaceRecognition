(()=>{"use strict";var e={56:(e,n,t)=>{e.exports=function(e){var n=t.nc;n&&e.setAttribute("nonce",n)}},72:e=>{var n=[];function t(e){for(var t=-1,a=0;a<n.length;a++)if(n[a].identifier===e){t=a;break}return t}function a(e,a){for(var o={},r=[],s=0;s<e.length;s++){var l=e[s],d=a.base?l[0]+a.base:l[0],c=o[d]||0,u="".concat(d," ").concat(c);o[d]=c+1;var m=t(u),p={css:l[1],media:l[2],sourceMap:l[3],supports:l[4],layer:l[5]};if(-1!==m)n[m].references++,n[m].updater(p);else{var h=i(p,a);a.byIndex=s,n.splice(s,0,{identifier:u,updater:h,references:1})}r.push(u)}return r}function i(e,n){var t=n.domAPI(n);return t.update(e),function(n){if(n){if(n.css===e.css&&n.media===e.media&&n.sourceMap===e.sourceMap&&n.supports===e.supports&&n.layer===e.layer)return;t.update(e=n)}else t.remove()}}e.exports=function(e,i){var o=a(e=e||[],i=i||{});return function(e){e=e||[];for(var r=0;r<o.length;r++){var s=t(o[r]);n[s].references--}for(var l=a(e,i),d=0;d<o.length;d++){var c=t(o[d]);0===n[c].references&&(n[c].updater(),n.splice(c,1))}o=l}}},113:e=>{e.exports=function(e,n){if(n.styleSheet)n.styleSheet.cssText=e;else{for(;n.firstChild;)n.removeChild(n.firstChild);n.appendChild(document.createTextNode(e))}}},249:(e,n,t)=>{t.d(n,{A:()=>s});var a=t(601),i=t.n(a),o=t(314),r=t.n(o)()(i());r.push([e.id,"/* CSS Custom Properties */\n:root {\n    --primary-color: 210 79% 46%; /* #2563eb */\n    --primary-dark: 217 91% 60%; /* #3b82f6 */\n    --secondary-color: 210 11% 98%; /* #f8fafc */\n    --accent-color: 34 100% 50%; /* #ffa500 */\n    --text-color: 210 11% 15%; /* #1e293b */\n    --text-light: 210 11% 71%; /* #64748b */\n    --border-color: 210 11% 91%; /* #e2e8f0 */\n    --success-color: 142 76% 36%; /* #16a34a */\n    --error-color: 0 84% 60%; /* #ef4444 */\n    --warning-color: 45 93% 47%; /* #eab308 */\n    --shadow: 0 1px 3px 0 rgb(0 0 0 / 0.1);\n    --shadow-lg: 0 10px 15px -3px rgb(0 0 0 / 0.1);\n    --radius: 0.5rem;\n    --radius-lg: 1rem;\n    --transition: all 0.3s ease;\n}\n\n/* Reset and Base Styles */\n* {\n    margin: 0;\n    padding: 0;\n    box-sizing: border-box;\n}\n\nbody {\n    font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;\n    background: linear-gradient(135deg, hsl(var(--secondary-color)), hsl(210 11% 96%));\n    color: hsl(var(--text-color));\n    line-height: 1.6;\n    min-height: 100vh;\n}\n\n.container {\n    max-width: 1200px;\n    margin: 0 auto;\n    padding: 0 1rem;\n}\n\n/* Header Styles */\n.header {\n    background: white;\n    box-shadow: var(--shadow);\n    border-bottom: 1px solid hsl(var(--border-color));\n    position: sticky;\n    top: 0;\n    z-index: 100;\n}\n\n.header .container {\n    display: flex;\n    justify-content: space-between;\n    align-items: center;\n    padding: 1rem;\n}\n\n.nav-brand {\n    display: flex;\n    align-items: center;\n    gap: 0.5rem;\n    font-size: 1.5rem;\n    font-weight: bold;\n    color: hsl(var(--primary-color));\n}\n\n.nav-brand i {\n    font-size: 2rem;\n}\n\n.nav-menu {\n    display: flex;\n    align-items: center;\n    gap: 1rem;\n}\n\n.nav-link {\n    display: flex;\n    align-items: center;\n    gap: 0.5rem;\n    padding: 0.75rem 1rem;\n    text-decoration: none;\n    color: hsl(var(--text-light));\n    border-radius: var(--radius);\n    transition: var(--transition);\n}\n\n.nav-link:hover,\n.nav-link.active {\n    background: hsl(var(--primary-color));\n    color: white;\n}\n#sidebar {\n    display: none; \n    position: fixed;\n    top: 0;\n    left: 0;\n    width: 250px;\n    height: 100vh;\n    background-color: #ffffff;\n    box-shadow: 2px 0 5px rgba(0, 0, 0, 0.1);\n    padding-top: 1.5rem;\n    z-index: 1500;\n    overflow-y: auto;\n    border-right: 1px solid hsl(210 11% 91%);\n    transition: transform 0.3s ease;\n    transform: translateX(-100%);\n  }\n\n  #sidebar.active {\n    transform: translateX(0);\n  }\n\n  #sidebar .sidebar-brand {\n    display: flex;\n    align-items: center;\n    gap: 0.5rem;\n    font-size: 1.25rem;\n    font-weight: bold;\n    color: hsl(210 79% 46%);\n    padding: 0 1rem 1rem 1rem;\n    border-bottom: 1px solid hsl(210 11% 91%);\n  }\n\n  #sidebar .sidebar-menu {\n    display: flex;\n    flex-direction: column;\n    gap: 0.5rem;\n    padding: 1rem;\n  }\n\n  #sidebar .sidebar-menu a {\n    display: flex;\n    align-items: center;\n    gap: 0.75rem;\n    padding: 0.75rem 1rem;\n    text-decoration: none;\n    color: hsl(210 11% 15%);\n    border-radius: 0.5rem;\n    transition: background-color 0.3s ease, color 0.3s ease;\n    font-weight: 600;\n  }\n\n  #sidebar .sidebar-menu a:hover,\n  #sidebar .sidebar-menu a.active {\n    background-color: hsl(210 79% 46%);\n    color: #fff;\n  }\n\n  /* Hamburger button for toggling sidebar */\n  #sidebarToggle {\n    display: none;\n    position: fixed;\n    top: 1rem;\n    left: 1rem;\n    z-index: 1600;\n    background: hsl(210 79% 46%);\n    border: none;\n    border-radius: 0.375rem;\n    color: white;\n    width: 40px;\n    height: 40px;\n    cursor: pointer;\n    align-items: center;\n    justify-content: center;\n    font-size: 1.25rem;\n    transition: background-color 0.3s ease;\n  }\n\n  #sidebarToggle:hover {\n    background: hsl(217 91% 60%);\n  }\n\n.logout-btn {\n    display: flex;\n    align-items: center;\n    gap: 0.5rem;\n    padding: 0.75rem 1rem;\n    background: hsl(var(--error-color));\n    color: white;\n    border: none;\n    border-radius: var(--radius);\n    cursor: pointer;\n    transition: var(--transition);\n}\n\n.logout-btn:hover {\n    background: hsl(0 84% 50%);\n}\n\n/* Main Content */\n.main-content {\n    padding: 2rem 0;\n    min-height: calc(100vh - 80px);\n}\n\n/* Form Styles */\n.form-group {\n    margin-bottom: 1.5rem;\n}\n\n.form-label {\n    display: block;\n    margin-bottom: 0.5rem;\n    font-weight: 500;\n    color: hsl(var(--text-color));\n}\n\n.form-input,\n.form-select,\n.form-textarea {\n    width: 100%;\n    padding: 0.75rem;\n    border: 1px solid hsl(var(--border-color));\n    border-radius: var(--radius);\n    font-size: 1rem;\n    transition: var(--transition);\n}\n\n.form-input:focus,\n.form-select:focus,\n.form-textarea:focus {\n    outline: none;\n    border-color: hsl(var(--primary-color));\n    box-shadow: 0 0 0 3px hsl(var(--primary-color) / 0.1);\n}\n\n.form-textarea {\n    min-height: 100px;\n    resize: vertical;\n}\n\n/* Button Styles */\n.btn {\n    display: inline-flex;\n    align-items: center;\n    gap: 0.5rem;\n    padding: 0.75rem 1.5rem;\n    font-size: 1rem;\n    font-weight: 500;\n    text-decoration: none;\n    border: none;\n    border-radius: var(--radius);\n    cursor: pointer;\n    transition: var(--transition);\n}\n\n.btn-primary {\n    background: hsl(var(--primary-color));\n    color: white;\n}\n\n.btn-primary:hover {\n    background: hsl(var(--primary-dark));\n}\n\n.btn-secondary {\n    background: hsl(var(--border-color));\n    color: hsl(var(--text-color));\n}\n\n.btn-secondary:hover {\n    background: hsl(210 11% 85%);\n}\n\n.btn-success {\n    background: hsl(var(--success-color));\n    color: white;\n}\n\n.btn-success:hover {\n    background: hsl(142 76% 30%);\n}\n\n.btn-danger {\n    background: hsl(var(--error-color));\n    color: white;\n}\n\n.btn-danger:hover {\n    background: hsl(0 84% 50%);\n}\n\n.btn-warning {\n    background: hsl(var(--warning-color));\n    color: white;\n}\n\n.btn-warning:hover {\n    background: hsl(45 93% 40%);\n}\n\n/* Card Styles */\n.card {\n    background: white;\n    border-radius: var(--radius-lg);\n    padding: 2rem;\n    box-shadow: var(--shadow);\n    margin-bottom: 2rem;\n}\n\n.card-header {\n    display: flex;\n    justify-content: space-between;\n    align-items: center;\n    margin-bottom: 1.5rem;\n    padding-bottom: 1rem;\n    border-bottom: 1px solid hsl(var(--border-color));\n}\n\n.card-title {\n    font-size: 1.5rem;\n    font-weight: bold;\n    color: hsl(var(--text-color));\n}\n\n/* Login Page Styles */\n.login-container {\n    display: flex;\n    align-items: center;\n    justify-content: center;\n    min-height: 100vh;\n    padding: 2rem;\n}\n\n.login-card {\n    width: 100%;\n    max-width: 400px;\n    background: white;\n    border-radius: var(--radius-lg);\n    padding: 2rem;\n    box-shadow: var(--shadow-lg);\n}\n\n.login-header {\n    text-align: center;\n    margin-bottom: 2rem;\n}\n\n.login-header i {\n    font-size: 3rem;\n    color: hsl(var(--primary-color));\n    margin-bottom: 1rem;\n}\n\n.login-header h1 {\n    color: hsl(var(--text-color));\n    margin-bottom: 0.5rem;\n}\n\n.login-header p {\n    color: hsl(var(--text-light));\n}\n\n/* Table Styles */\n.patients-table {\n    width: 100%;\n    border-collapse: collapse;\n    background: white;\n    border-radius: var(--radius);\n    overflow: hidden;\n    box-shadow: var(--shadow);\n    margin-top: 1rem;\n}\n\n.patients-table th,\n.patients-table td {\n    padding: 1rem;\n    text-align: left;\n    border-bottom: 1px solid hsl(var(--border-color));\n}\n\n.patients-table th {\n    background: hsl(var(--secondary-color));\n    font-weight: 600;\n    color: hsl(var(--text-color));\n}\n\n.patients-table tr:hover {\n    background: hsl(var(--secondary-color));\n}\n\n.patients-table .patient-photo {\n    width: 40px;\n    height: 40px;\n    border-radius: 50%;\n    object-fit: cover;\n    background: hsl(var(--border-color));\n}\n\n/* Search and Filter Styles */\n.search-filter-section {\n    display: grid;\n    grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));\n    gap: 1rem;\n    margin-bottom: 1rem;\n}\n\n/* Patient List Styles */\n.patient-card {\n    background: white;\n    border-radius: var(--radius);\n    padding: 1.5rem;\n    box-shadow: var(--shadow);\n    margin-bottom: 1rem;\n    transition: var(--transition);\n}\n\n.patient-card:hover {\n    box-shadow: var(--shadow-lg);\n}\n\n.patient-header {\n    display: flex;\n    align-items: center;\n    gap: 1rem;\n    margin-bottom: 1rem;\n}\n\n.patient-avatar {\n    width: 60px;\n    height: 60px;\n    border-radius: 50%;\n    background: hsl(var(--primary-color));\n    display: flex;\n    align-items: center;\n    justify-content: center;\n    color: white;\n    font-size: 1.5rem;\n    font-weight: bold;\n}\n\n.patient-info {\n    display: grid;\n    grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));\n    gap: 1rem;\n}\n\n.info-item {\n    display: flex;\n    flex-direction: column;\n    gap: 0.25rem;\n}\n\n.info-label {\n    font-weight: 500;\n    color: hsl(var(--text-light));\n    font-size: 0.875rem;\n}\n\n.info-value {\n    font-size: 1rem;\n    color: hsl(var(--text-color));\n}\n\n/* Status badges */\n.status-badge {\n    padding: 0.25rem 0.75rem;\n    border-radius: 9999px;\n    font-size: 0.75rem;\n    font-weight: 500;\n}\n\n.status-active {\n    background: hsl(var(--success-color) / 0.1);\n    color: hsl(var(--success-color));\n}\n\n.status-inactive {\n    background: hsl(var(--error-color) / 0.1);\n    color: hsl(var(--error-color));\n}\n\n/* Face Recognition Styles */\n.camera-container {\n    position: relative;\n    background: #000;\n    border-radius: var(--radius-lg);\n    overflow: hidden;\n    margin-bottom: 1rem;\n    aspect-ratio: 16 / 9;\n    width: 100%;\n    max-width: 600px;\n    margin: 0 auto 1rem auto;\n}\n\n.camera-preview {\n    width: 100%;\n    height: 100%;\n    object-fit: cover;\n}\n\n.camera-placeholder {\n    display: flex;\n    align-items: center;\n    justify-content: center;\n    height: 100%;\n    background: hsl(210 11% 15%);\n    color: white;\n    flex-direction: column;\n    gap: 1rem;\n}\n\n.camera-placeholder i {\n    font-size: 4rem;\n    opacity: 0.5;\n}\n\n.capture-btn {\n    position: absolute;\n    bottom: 1rem;\n    left: 50%;\n    transform: translateX(-50%);\n    width: 60px;\n    height: 60px;\n    border-radius: 50%;\n    background: white;\n    border: 3px solid hsl(var(--primary-color));\n    cursor: pointer;\n    transition: var(--transition);\n}\n\n.capture-btn:hover {\n    background: hsl(var(--primary-color));\n    color: white;\n}\n\n.captured-image {\n    width: 100%;\n    height: 400px;\n    object-fit: cover;\n    border-radius: var(--radius-lg);\n}\n\n.recognition-result {\n    padding: 1rem;\n    border-radius: var(--radius);\n    margin: 1rem 0;\n    text-align: center;\n}\n\n.recognition-result.success {\n    background: hsl(var(--success-color) / 0.1);\n    border: 1px solid hsl(var(--success-color));\n    color: hsl(var(--success-color));\n}\n\n.recognition-result.pending {\n    background: hsl(var(--warning-color) / 0.1);\n    border: 1px solid hsl(var(--warning-color));\n    color: hsl(var(--warning-color));\n}\n\n/* Queue Styles */\n.queue-stats {\n    display: grid;\n    grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));\n    gap: 1rem;\n    margin-bottom: 2rem;\n}\n\n.stat-card {\n    background: white;\n    border-radius: var(--radius);\n    padding: 1.5rem;\n    text-align: center;\n    box-shadow: var(--shadow);\n}\n\n.stat-number {\n    font-size: 2rem;\n    font-weight: bold;\n    color: hsl(var(--primary-color));\n    margin-bottom: 0.5rem;\n}\n\n.stat-label {\n    color: hsl(var(--text-light));\n    font-size: 0.875rem;\n}\n\n.queue-table {\n    width: 100%;\n    border-collapse: collapse;\n    background: white;\n    border-radius: var(--radius);\n    overflow: hidden;\n    box-shadow: var(--shadow);\n}\n\n.queue-table th,\n.queue-table td {\n    padding: 1rem;\n    text-align: left;\n    border-bottom: 1px solid hsl(var(--border-color));\n}\n\n.queue-table th {\n    background: hsl(var(--secondary-color));\n    font-weight: 600;\n    color: hsl(var(--text-color));\n}\n\n.queue-table tr:hover {\n    background: hsl(var(--secondary-color));\n}\n\n.status-waiting {\n    background: hsl(var(--warning-color) / 0.1);\n    color: hsl(var(--warning-color));\n}\n\n.status-examining {\n    background: hsl(var(--primary-color) / 0.1);\n    color: hsl(var(--primary-color));\n}\n\n.status-completed {\n    background: hsl(var(--success-color) / 0.1);\n    color: hsl(var(--success-color));\n}\n\n/* Dashboard Styles */\n.dashboard-grid {\n    display: grid;\n    grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));\n    gap: 2rem;\n    margin-bottom: 2rem;\n}\n\n.quick-actions {\n    display: grid;\n    grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));\n    gap: 1rem;\n    margin-top: 2rem;\n}\n\n.action-card {\n    background: white;\n    border-radius: var(--radius);\n    padding: 1.5rem;\n    text-align: center;\n    text-decoration: none;\n    color: hsl(var(--text-color));\n    box-shadow: var(--shadow);\n    transition: var(--transition);\n}\n\n.action-card:hover {\n    transform: translateY(-2px);\n    box-shadow: var(--shadow-lg);\n}\n\n.action-card i {\n    font-size: 2rem;\n    color: hsl(var(--primary-color));\n    margin-bottom: 1rem;\n}\n\n.action-card h3 {\n    font-size: 1rem;\n    margin-bottom: 0.5rem;\n}\n\n.action-card p {\n    font-size: 0.875rem;\n    color: hsl(var(--text-light));\n}\n\n/* Medical History Styles */\n.medical-history {\n    margin-top: 2rem;\n}\n\n.history-item {\n    background: hsl(var(--secondary-color));\n    border-radius: var(--radius);\n    padding: 1rem;\n    margin-bottom: 1rem;\n    border-left: 4px solid hsl(var(--primary-color));\n}\n\n.history-date {\n    font-size: 0.875rem;\n    color: hsl(var(--text-light));\n    margin-bottom: 0.5rem;\n}\n\n.history-doctor {\n    font-weight: 500;\n    color: hsl(var(--primary-color));\n    margin-bottom: 0.5rem;\n}\n\n.history-complaint {\n    color: hsl(var(--text-color));\n    line-height: 1.5;\n}\n\n/* Modal Styles */\n.modal-overlay {\n    position: fixed;\n    top: 0;\n    left: 0;\n    right: 0;\n    bottom: 0;\n    background: rgba(0, 0, 0, 0.5);\n    display: flex;\n    align-items: center;\n    justify-content: center;\n    z-index: 1000;\n    padding: 1rem;\n}\n\n.modal {\n    background: white;\n    border-radius: var(--radius-lg);\n    max-width: 500px;\n    width: 100%;\n    max-height: 90vh;\n    overflow-y: auto;\n    box-shadow: var(--shadow-lg);\n}\n\n.modal-header {\n    display: flex;\n    justify-content: space-between;\n    align-items: center;\n    padding: 1.5rem;\n    border-bottom: 1px solid hsl(var(--border-color));\n}\n\n.modal-header h3 {\n    color: hsl(var(--text-color));\n}\n\n.modal-close {\n    background: none;\n    border: none;\n    font-size: 1.5rem;\n    color: hsl(var(--text-light));\n    cursor: pointer;\n    padding: 0.25rem;\n    border-radius: var(--radius);\n    transition: var(--transition);\n}\n\n.modal-close:hover {\n    background: hsl(var(--border-color));\n}\n\n.modal-body {\n    padding: 1.5rem;\n}\n\n.modal-footer {\n    display: flex;\n    justify-content: flex-end;\n    gap: 1rem;\n    padding: 1.5rem;\n    border-top: 1px solid hsl(var(--border-color));\n}\n\n.custom-modal-overlay {\n    position: fixed;\n    top: 0;\n    left: 0;\n    width: 100%;\n    height: 100%;\n    background-color: rgba(0, 0, 0, 0.6);\n    display: flex;\n    justify-content: center;\n    align-items: center;\n    z-index: 1000;\n    opacity: 0;\n    visibility: hidden;\n    transition: opacity 0.3s ease-out, visibility 0.3s ease-out;\n}\n\n.custom-modal-overlay.show {\n    opacity: 1;\n    visibility: visible;\n}\n\n.custom-modal {\n    background-color: #fff;\n    padding: 2rem;\n    border-radius: 8px;\n    box-shadow: 0 5px 15px rgba(0, 0, 0, 0.3);\n    max-width: 600px;\n    width: 90%;\n    transform: translateY(-20px);\n    transition: transform 0.3s ease-out;\n    display: flex;\n    flex-direction: column;\n    max-height: 90vh;\n    overflow-y: auto;\n}\n\n.custom-modal-overlay.show .custom-modal {\n    transform: translateY(0);\n}\n\n.custom-modal-header {\n    display: flex;\n    justify-content: space-between;\n    align-items: center;\n    padding-bottom: 1rem;\n    margin-bottom: 1rem;\n    border-bottom: 1px solid #eee;\n}\n\n.custom-modal-header h3 {\n    margin: 0;\n    font-size: 1.5rem;\n    color: #333;\n}\n\n.custom-modal-close-btn {\n    background: none;\n    border: none;\n    font-size: 1.8rem;\n    cursor: pointer;\n    color: #666;\n    transition: color 0.2s ease;\n}\n\n.custom-modal-close-btn:hover {\n    color: #333;\n}\n\n.custom-modal-body {\n    flex-grow: 1;\n    padding-bottom: 1rem;\n}\n\n.custom-modal-footer {\n    display: flex;\n    justify-content: flex-end;\n    gap: 0.75rem;\n    padding-top: 1rem;\n    border-top: 1px solid #eee;\n}\n\n.form-group {\n    margin-bottom: 1rem;\n}\n\n.form-label {\n    display: block;\n    margin-bottom: 0.5rem;\n    font-weight: 500;\n    color: #555;\n}\n\n.form-textarea {\n    width: 100%;\n    padding: 0.75rem;\n    border: 1px solid #ccc;\n    border-radius: 4px;\n    font-size: 1rem;\n    box-sizing: border-box;\n    resize: vertical;\n    min-height: 80px;\n}\n\n.form-textarea:focus {\n    border-color: #3b82f6;\n    outline: none;\n    box-shadow: 0 0 0 2px rgba(59, 130, 246, 0.2);\n}\n\n.modal-open {\n    overflow: hidden;\n}\n\n.btn {\n    padding: 0.75rem 1.5rem;\n    border-radius: 4px;\n    cursor: pointer;\n    font-size: 1rem;\n    font-weight: 600;\n    text-align: center;\n    text-decoration: none;\n    display: inline-flex;\n    align-items: center;\n    justify-content: center;\n    gap: 0.5rem;\n    transition: background-color 0.2s ease, border-color 0.2s ease, color 0.2s ease;\n}\n\n.btn-primary {\n    background-color: #3b82f6;\n    color: white;\n    border: 1px solid #3b82f6;\n}\n\n.btn-primary:hover {\n    background-color: #2563eb;\n    border-color: #2563eb;\n}\n\n.btn-success {\n    background-color: #28a745;\n    color: white;\n    border: 1px solid #28a745;\n}\n\n.btn-success:hover {\n    background-color: #218838;\n    border-color: #1e7e34;\n}\n\n.btn-secondary {\n    background-color: #6c757d;\n    color: white;\n    border: 1px solid #6c757d;\n}\n\n.btn-secondary:hover {\n    background-color: #5a6268;\n    border-color: #545b62;\n}\n\n/* Loading Spinner */\n.loading-spinner {\n    position: fixed;\n    top: 0;\n    left: 0;\n    right: 0;\n    bottom: 0;\n    background: rgba(255, 255, 255, 0.9);\n    display: flex;\n    align-items: center;\n    justify-content: center;\n    z-index: 999;\n}\n\n.spinner {\n    text-align: center;\n    color: hsl(var(--primary-color));\n}\n\n.spinner i {\n    font-size: 2rem;\n    margin-bottom: 1rem;\n}\n\n/* Responsive Design */\n@media (max-width: 768px) {\n    .nav-menu {\n        flex-direction: column;\n        gap: 0.5rem;\n        width: 100%;\n    }\n\n    .header .container {\n        flex-direction: column;\n        gap: 1rem;\n    }\n\n    .patient-info {\n        grid-template-columns: 1fr;\n    }\n\n    .patients-table {\n        font-size: 0.875rem;\n    }\n\n    .patients-table th,\n    .patients-table td {\n        padding: 0.75rem 0.5rem;\n    }\n\n    .modal {\n        margin: 1rem;\n    }\n\n    .search-filter-section {\n        grid-template-columns: 1fr;\n    }\n\n    .camera-container {\n        aspect-ratio: 16 / 9;\n    }\n\n    .camera-placeholder i {\n        font-size: 3rem;\n    }\n\n    .capture-btn {\n        width: 50px;\n        height: 50px;\n        bottom: 0.5rem;\n    }\n}\n@media (max-width: 768px) {\n    header.header {\n      display: none !important;\n    }\n\n    #sidebar {\n      display: block;\n    }\n\n    #sidebarToggle {\n      display: flex;\n    }\n\n    body.sidebar-open {\n      overflow-x: hidden;\n    }\n\n    #sidebarOverlay {\n      display: none;\n      position: fixed;\n      top: 0;\n      left: 0;\n      width: 100vw;\n      height: 100vh;\n      background: rgba(0, 0, 0, 0.3);\n      z-index: 1400;\n      transition: opacity 0.3s ease;\n    }\n\n    body.sidebar-open #sidebarOverlay {\n      display: block;\n    }\n  }\n\n/* Utility Classes */\n.text-center {\n    text-align: center;\n}\n\n.text-left {\n    text-align: left;\n}\n\n.text-right {\n    text-align: right;\n}\n\n.mb-0 {\n    margin-bottom: 0;\n}\n\n.mb-1 {\n    margin-bottom: 0.5rem;\n}\n\n.mb-2 {\n    margin-bottom: 1rem;\n}\n\n.mb-3 {\n    margin-bottom: 1.5rem;\n}\n\n.mt-0 {\n    margin-top: 0;\n}\n\n.mt-1 {\n    margin-top: 0.5rem;\n}\n\n.mt-2 {\n    margin-top: 1rem;\n}\n\n.mt-3 {\n    margin-top: 1.5rem;\n}\n\n.hidden {\n    display: none !important;\n}\n\n.fade-in {\n    animation: fadeIn 0.3s ease-in;\n}\n\n@keyframes fadeIn {\n    from {\n        opacity: 0;\n        transform: translateY(10px);\n    }\n    to {\n        opacity: 1;\n        transform: translateY(0);\n    }\n}",""]);const s=r},314:e=>{e.exports=function(e){var n=[];return n.toString=function(){return this.map((function(n){var t="",a=void 0!==n[5];return n[4]&&(t+="@supports (".concat(n[4],") {")),n[2]&&(t+="@media ".concat(n[2]," {")),a&&(t+="@layer".concat(n[5].length>0?" ".concat(n[5]):""," {")),t+=e(n),a&&(t+="}"),n[2]&&(t+="}"),n[4]&&(t+="}"),t})).join("")},n.i=function(e,t,a,i,o){"string"==typeof e&&(e=[[null,e,void 0]]);var r={};if(a)for(var s=0;s<this.length;s++){var l=this[s][0];null!=l&&(r[l]=!0)}for(var d=0;d<e.length;d++){var c=[].concat(e[d]);a&&r[c[0]]||(void 0!==o&&(void 0===c[5]||(c[1]="@layer".concat(c[5].length>0?" ".concat(c[5]):""," {").concat(c[1],"}")),c[5]=o),t&&(c[2]?(c[1]="@media ".concat(c[2]," {").concat(c[1],"}"),c[2]=t):c[2]=t),i&&(c[4]?(c[1]="@supports (".concat(c[4],") {").concat(c[1],"}"),c[4]=i):c[4]="".concat(i)),n.push(c))}},n}},504:(e,n,t)=>{t.r(n),t.d(n,{addDoctor:()=>p,addPatient:()=>r,addQueue:()=>f,deleteDoctor:()=>g,deletePatient:()=>d,generateFaceEmbedding:()=>y,getDoctors:()=>m,getPatientById:()=>l,getPatientByName:()=>o,getPatients:()=>s,getQueues:()=>u,getUsers:()=>c,loginUser:()=>i,recognizeFace:()=>b,updateDoctor:()=>h,updateQueue:()=>v});const a="https://backend-mediface.vercel.app/api";async function i(e){try{const n=await fetch(`${a}/auth/login`,{method:"POST",headers:{"Content-Type":"application/json",Accept:"application/json"},body:JSON.stringify(e)});if(!n.ok){const e=await n.json();throw new Error(e.message||"Login gagal")}return(await n.json()).token}catch(e){if(e instanceof TypeError&&"Failed to fetch"===e.message)throw new Error("Gagal menghubungi server. Periksa koneksi jaringan atau konfigurasi CORS.");throw e}}async function o(e,n){const t=await fetch(`${a}/patients`,{method:"GET",headers:{Authorization:`Bearer ${n}`}});if(!t.ok){const e=await t.json();throw new Error(e.message||"Gagal mengambil data pasien")}return(await t.json()).find((n=>n.name.toLowerCase()===e.toLowerCase()))}async function r(e,n){try{const t=await fetch(`${a}/patients`,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${n}`},body:JSON.stringify(e)});if(!t.ok){const e=await t.json();throw new Error(e.message||"Gagal menambahkan pasien")}return await t.json()}catch(e){if(e instanceof TypeError&&"Failed to fetch"===e.message)throw new Error("Gagal menghubungi server. Periksa koneksi jaringan atau konfigurasi CORS.");throw e}}async function s(e){try{const n=await fetch(`${a}/patients`,{method:"GET",headers:{Authorization:`Bearer ${e}`}});if(!n.ok){const e=await n.json();throw new Error(e.message||"Gagal mengambil data pasien")}return await n.json()}catch(e){if(e instanceof TypeError&&"Failed to fetch"===e.message)throw new Error("Gagal menghubungi server. Periksa koneksi jaringan atau konfigurasi CORS.");throw e}}async function l(e,n){try{const t=await fetch(`${a}/patients/${e}`,{method:"GET",headers:{Authorization:`Bearer ${n}`}});if(!t.ok){const e=await t.json();throw new Error(e.message||"Gagal mengambil data pasien")}return await t.json()}catch(e){if(e instanceof TypeError&&"Failed to fetch"===e.message)throw new Error("Gagal menghubungi server. Periksa koneksi jaringan atau konfigurasi CORS.");throw e}}async function d(e,n){try{const t=await fetch(`${a}/patients/${e}`,{method:"DELETE",headers:{Authorization:`Bearer ${n}`}});if(!t.ok){const e=await t.json();throw new Error(e.message||"Gagal menghapus pasien")}return await t.json()}catch(e){if(e instanceof TypeError&&"Failed to fetch"===e.message)throw new Error("Gagal menghubungi server. Periksa koneksi jaringan atau konfigurasi CORS.");throw e}}async function c(e){try{const n=await fetch(`${a}/users`,{method:"GET",headers:{Authorization:`Bearer ${e}`}});if(!n.ok){const e=await n.json();throw new Error(e.message||"Gagal mengambil data user")}return await n.json()}catch(e){if(e instanceof TypeError&&"Failed to fetch"===e.message)throw new Error("Gagal menghubungi server. Periksa koneksi jaringan atau konfigurasi CORS.");throw e}}async function u(e){try{const n=await fetch(`${a}/queues`,{method:"GET",headers:{Authorization:`Bearer ${e}`}});if(!n.ok){const e=await n.json();throw new Error(e.message||"Gagal mengambil data antrian")}return await n.json()}catch(e){if(e instanceof TypeError&&"Failed to fetch"===e.message)throw new Error("Gagal menghubungi server. Periksa koneksi jaringan atau konfigurasi CORS.");throw e}}async function m(e){try{const n=await fetch(`${a}/doctors`,{method:"GET",headers:{Authorization:`Bearer ${e}`}});if(!n.ok){const e=await n.json();throw new Error(e.message||"Gagal mengambil data dokter")}return await n.json()}catch(e){if(e instanceof TypeError&&"Failed to fetch"===e.message)throw new Error("Gagal menghubungi server. Periksa koneksi jaringan atau konfigurasi CORS.");throw e}}async function p(e,n){try{const t=await fetch(`${a}/doctors`,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${n}`},body:JSON.stringify(e)});if(!t.ok){const e=await t.json();throw new Error(e.message||"Gagal menambahkan dokter")}return await t.json()}catch(e){if(e instanceof TypeError&&"Failed to fetch"===e.message)throw new Error("Gagal menghubungi server. Periksa koneksi jaringan atau konfigurasi CORS.");throw e}}async function h(e,n,t){try{const i=await fetch(`${a}/doctors/${e}`,{method:"PUT",headers:{"Content-Type":"application/json",Authorization:`Bearer ${t}`},body:JSON.stringify(n)});if(!i.ok){const e=await i.json();throw new Error(e.message||"Gagal memperbarui data dokter")}return await i.json()}catch(e){if(e instanceof TypeError&&"Failed to fetch"===e.message)throw new Error("Gagal menghubungi server. Periksa koneksi jaringan atau konfigurasi CORS.");throw e}}async function g(e,n){try{const t=await fetch(`${a}/doctors/${e}`,{method:"DELETE",headers:{Authorization:`Bearer ${n}`}});if(!t.ok){const e=await t.json();throw new Error(e.message||"Gagal menghapus dokter")}return await t.json()}catch(e){if(e instanceof TypeError&&"Failed to fetch"===e.message)throw new Error("Gagal menghubungi server. Periksa koneksi jaringan atau konfigurasi CORS.");throw e}}async function f(e,n){try{const t=await fetch(`${a}/queues`,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${n}`},body:JSON.stringify(e)});if(!t.ok){const e=await t.json();throw new Error(e.message||"Gagal menambahkan antrian")}return await t.json()}catch(e){if(e instanceof TypeError&&"Failed to fetch"===e.message)throw new Error("Gagal menghubungi server. Periksa koneksi jaringan atau konfigurasi CORS.");throw e}}async function v(e,n,t){try{const i=await fetch(`${a}/queues/${e}`,{method:"PUT",headers:{"Content-Type":"application/json",Authorization:`Bearer ${t}`},body:JSON.stringify(n)});if(!i.ok){const e=await i.json();throw new Error(e.message||"Gagal memperbarui data antrian")}return await i.json()}catch(e){if(e instanceof TypeError&&"Failed to fetch"===e.message)throw new Error("Gagal menghubungi server. Periksa koneksi jaringan atau konfigurasi CORS.");throw e}}async function b(e){try{const n=await fetch("https://web-production-9ea44.up.railway.app/recognize",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({photo:e})});if(!n.ok){const e=await n.json();throw new Error(e?.error||"Gagal mengenali wajah")}return await n.json()}catch(e){throw console.error("recognizeFace error:",e),e}}async function y({patient_id:e,name:n,photos:t}){try{const a=await fetch("https://web-production-9ea44.up.railway.app/generate-embedding",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({patient_id:e,name:n,photos:t})});if(!a.ok){const e=await a.json();throw new Error(e?.error||"Gagal generate embedding")}return await a.json()}catch(e){throw console.error("generateFaceEmbedding error:",e),e}}},540:e=>{e.exports=function(e){var n=document.createElement("style");return e.setAttributes(n,e.attributes),e.insert(n,e.options),n}},601:e=>{e.exports=function(e){return e[1]}},659:e=>{var n={};e.exports=function(e,t){var a=function(e){if(void 0===n[e]){var t=document.querySelector(e);if(window.HTMLIFrameElement&&t instanceof window.HTMLIFrameElement)try{t=t.contentDocument.head}catch(e){t=null}n[e]=t}return n[e]}(e);if(!a)throw new Error("Couldn't find a style target. This probably means that the value for the 'insert' parameter is invalid.");a.appendChild(t)}},825:e=>{e.exports=function(e){if("undefined"==typeof document)return{update:function(){},remove:function(){}};var n=e.insertStyleElement(e);return{update:function(t){!function(e,n,t){var a="";t.supports&&(a+="@supports (".concat(t.supports,") {")),t.media&&(a+="@media ".concat(t.media," {"));var i=void 0!==t.layer;i&&(a+="@layer".concat(t.layer.length>0?" ".concat(t.layer):""," {")),a+=t.css,i&&(a+="}"),t.media&&(a+="}"),t.supports&&(a+="}");var o=t.sourceMap;o&&"undefined"!=typeof btoa&&(a+="\n/*# sourceMappingURL=data:application/json;base64,".concat(btoa(unescape(encodeURIComponent(JSON.stringify(o))))," */")),n.styleTagTransform(a,e,n.options)}(n,e,t)},remove:function(){!function(e){if(null===e.parentNode)return!1;e.parentNode.removeChild(e)}(n)}}}}},n={};function t(a){var i=n[a];if(void 0!==i)return i.exports;var o=n[a]={id:a,exports:{}};return e[a](o,o.exports,t),o.exports}t.n=e=>{var n=e&&e.__esModule?()=>e.default:()=>e;return t.d(n,{a:n}),n},t.d=(e,n)=>{for(var a in n)t.o(n,a)&&!t.o(e,a)&&Object.defineProperty(e,a,{enumerable:!0,get:n[a]})},t.o=(e,n)=>Object.prototype.hasOwnProperty.call(e,n),t.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},t.nc=void 0;var a=t(72),i=t.n(a),o=t(825),r=t.n(o),s=t(659),l=t.n(s),d=t(56),c=t.n(d),u=t(540),m=t.n(u),p=t(113),h=t.n(p),g=t(249),f={};f.styleTagTransform=h(),f.setAttributes=c(),f.insert=l().bind(null,"head"),f.domAPI=r(),f.insertStyleElement=m(),i()(g.A,f),g.A&&g.A.locals&&g.A.locals;const v={init(){this.get("initialized")||(this.set("initialized",!0),this.set("patients",[]),this.set("queue",[]),this.set("doctors",[]))},get(e){try{const n=localStorage.getItem(e);return n?JSON.parse(n):null}catch(e){return console.error("Error reading from localStorage:",e),null}},set(e,n){try{return localStorage.setItem(e,JSON.stringify(n)),!0}catch(e){return console.error("Error writing to localStorage:",e),!1}},remove(e){try{return localStorage.removeItem(e),!0}catch(e){return console.error("Error removing from localStorage:",e),!1}},clear(){try{return localStorage.clear(),!0}catch(e){return console.error("Error clearing localStorage:",e),!1}},getKeys(){try{return Object.keys(localStorage)}catch(e){return console.error("Error getting localStorage keys:",e),[]}},has:e=>null!==localStorage.getItem(e),getSize(){try{let e=0;for(let n in localStorage)localStorage.hasOwnProperty(n)&&(e+=localStorage[n].length+n.length);return e}catch(e){return console.error("Error calculating storage size:",e),0}},exportData(){try{const e={};for(let n in localStorage)localStorage.hasOwnProperty(n)&&(e[n]=this.get(n));return e}catch(e){return console.error("Error exporting data:",e),{}}},importData(e){try{for(let n in e)e.hasOwnProperty(n)&&this.set(n,e[n]);return!0}catch(e){return console.error("Error importing data:",e),!1}}},b={async start(e){try{if(!navigator.mediaDevices||!navigator.mediaDevices.getUserMedia)throw new Error("Camera tidak didukung di browser ini");const n=await navigator.mediaDevices.getUserMedia({video:{width:{ideal:640},height:{ideal:480},facingMode:"user"},audio:!1}),t=document.getElementById(e);if(!t)throw new Error("Video element tidak ditemukan");return t.srcObject=n,await new Promise(((e,n)=>{t.onloadedmetadata=e,t.onerror=n,setTimeout((()=>n(new Error("Timeout menunggu kamera"))),1e4)})),n}catch(e){console.error("Error starting camera:",e);let n="Gagal mengakses kamera";throw"NotAllowedError"===e.name?n="Akses kamera ditolak. Silakan izinkan akses kamera di browser.":"NotFoundError"===e.name?n="Kamera tidak ditemukan di perangkat ini.":"NotReadableError"===e.name?n="Kamera sedang digunakan oleh aplikasi lain.":"OverconstrainedError"===e.name?n="Kamera tidak mendukung resolusi yang diminta.":e.message&&(n=e.message),new Error(n)}},stop(e){try{e&&e.getTracks().forEach((e=>{e.stop()}))}catch(e){console.error("Error stopping camera:",e)}},capture(e,n,t=.8){try{const a=document.getElementById(e),i=document.getElementById(n);if(!a||!i)throw new Error("Video atau canvas element tidak ditemukan");const o=a.videoWidth,r=a.videoHeight;if(0===o||0===r)throw new Error("Video belum siap untuk capture");return i.width=o,i.height=r,i.getContext("2d").drawImage(a,0,0,o,r),i.toDataURL("image/jpeg",t)}catch(e){throw console.error("Error capturing image:",e),new Error("Gagal mengambil foto: "+e.message)}},async checkAvailability(){try{if(!navigator.mediaDevices||!navigator.mediaDevices.getUserMedia)return!1;return(await navigator.mediaDevices.enumerateDevices()).filter((e=>"videoinput"===e.kind)).length>0}catch(e){return console.error("Error checking camera availability:",e),!1}},async getAvailableCameras(){try{if(!navigator.mediaDevices||!navigator.mediaDevices.enumerateDevices)return[];const e=(await navigator.mediaDevices.enumerateDevices()).filter((e=>"videoinput"===e.kind));return e.map((n=>({deviceId:n.deviceId,label:n.label||`Camera ${e.indexOf(n)+1}`,groupId:n.groupId})))}catch(e){return console.error("Error getting available cameras:",e),[]}},async startWithDevice(e,n){try{const t=await navigator.mediaDevices.getUserMedia({video:{deviceId:{exact:n},width:{ideal:640},height:{ideal:480}},audio:!1}),a=document.getElementById(e);if(!a)throw new Error("Video element tidak ditemukan");return a.srcObject=t,await new Promise(((e,n)=>{a.onloadedmetadata=e,a.onerror=n,setTimeout((()=>n(new Error("Timeout"))),1e4)})),t}catch(e){throw console.error("Error starting camera with device:",e),new Error("Gagal mengakses kamera yang dipilih: "+e.message)}},async requestPermissions(){try{const e=await navigator.mediaDevices.getUserMedia({video:!0,audio:!1});return this.stop(e),!0}catch(e){return console.error("Error requesting camera permissions:",e),!1}}};class y{constructor(){this.routes={},this.defaultRoute=null,this.params={}}addRoute(e,n){this.routes[e]=n}setDefaultRoute(e){this.defaultRoute=e}navigate(e,n={}){this.params=n,history.pushState({path:e,params:n},"",`#${e}`),this.executeRoute(e)}executeRoute(e){const n=this.routes[e];n?n():this.defaultRoute&&this.defaultRoute()}start(){window.addEventListener("popstate",(e=>{if(e.state&&e.state.path)this.params=e.state.params||{},this.executeRoute(e.state.path);else{const e=window.location.hash.slice(1);e?this.executeRoute(e):this.defaultRoute&&this.defaultRoute()}}));const e=window.location.hash.slice(1);e?this.executeRoute(e):this.defaultRoute&&this.defaultRoute()}getParams(){return this.params}getCurrentPath(){return window.location.hash.slice(1)}}const w={render:()=>'\n            <div class="login-container">\n                <div class="login-card fade-in">\n                    <div class="login-header">\n                        <i class="fas fa-user-md"></i>\n                        <h1>Sistem Rumah Sakit</h1>\n                        <p>Silakan login untuk melanjutkan</p>\n                    </div>\n                    <form id="loginForm">\n                        <div class="form-group">\n                            <label class="form-label" for="username">Username</label>\n                            <input \n                                type="text" \n                                id="username" \n                                name="username" \n                                class="form-input" \n                                placeholder="Masukkan username"\n                                required\n                            >\n                        </div>\n                        <div class="form-group">\n                            <label class="form-label" for="password">Password</label>\n                            <input \n                                type="password" \n                                id="password" \n                                name="password" \n                                class="form-input" \n                                placeholder="Masukkan password"\n                                required\n                            >\n                        </div>\n                        <button type="submit" id="loginButton" class="btn btn-primary" style="width: 100%;">\n                            <i class="fas fa-sign-in-alt"></i>\n                            Login\n                        </button>\n                    </form>\n                    <div class="mt-3 text-center">\n                        <small style="color: #64748b;">\n                            Kredensial: username: <strong>admin1</strong>, password: <strong>admin1</strong>\n                        </small>\n                    </div>\n                </div>\n            </div>\n        ',init(e){const n=document.getElementById("loginForm"),t=document.getElementById("username"),a=document.getElementById("password"),i=document.getElementById("loginButton");n.addEventListener("submit",(async n=>{n.preventDefault();const o={username:t.value.trim(),password:a.value.trim()};if(o.username&&o.password){this.setLoadingState(i,!0);try{await e.login(o),e.showNotification("Login berhasil! Memuat dashboard...","success"),setTimeout((()=>{e.router.navigate("dashboard")}),500)}catch(n){console.error("Login error:",n),e.showNotification(n.message||"Login gagal","error"),this.setLoadingState(i,!1)}}else e.showNotification("Harap isi semua field","error")})),t.focus(),a.addEventListener("keypress",(e=>{"Enter"===e.key&&n.dispatchEvent(new Event("submit"))}))},setLoadingState(e,n){n?(e.disabled=!0,e.innerHTML='\n                <i class="fas fa-spinner fa-spin"></i>\n                Memuat...\n            ',e.classList.add("loading")):(e.disabled=!1,e.innerHTML='\n                <i class="fas fa-sign-in-alt"></i>\n                Login\n            ',e.classList.remove("loading"))}};var k=t(504);const x={users:[],patients:[],doctors:[],queues:[],isLoading:!1,async fetchData(e){if(!this.isLoading){this.isLoading=!0;try{this.updateLoadingState(!0);const[n,t,a,i]=await Promise.all([(0,k.getUsers)(e),(0,k.getPatients)(e),(0,k.getDoctors)(e),(0,k.getQueues)(e)]);this.users=n,this.patients=t,this.doctors=a,this.queues=await this.processQueueData(i),this.updateContent()}catch(e){console.error("Gagal mengambil data dashboard:",e),this.users=[],this.patients=[],this.doctors=[],this.queues=[],this.updateErrorState(e.message)}finally{this.isLoading=!1,this.updateLoadingState(!1)}}},updateLoadingState(e){const n=document.querySelector(".fade-in");n&&(e?n.classList.add("loading"):n.classList.remove("loading"))},updateErrorState(e){const n=document.querySelector(".fade-in");n&&(n.innerHTML=`\n        <div class="card">\n          <div class="card-header">\n            <h2 class="card-title">\n              <i class="fas fa-exclamation-triangle" style="color: #ef4444;"></i>\n              Error\n            </h2>\n          </div>\n          <div style="padding: 2rem; text-align: center;">\n            <p style="color: #ef4444; margin-bottom: 1rem;">${e}</p>\n            <button onclick="location.reload()" class="btn btn-primary">\n              <i class="fas fa-refresh"></i>\n              Muat Ulang\n            </button>\n          </div>\n        </div>\n      `)},updateContent(){const e=this.getStats(),n=document.querySelectorAll(".stat-number");n.length>=4&&(n[0].textContent=e.totalPatients,n[1].textContent=e.queueToday,n[2].textContent=e.activeDoctors,n[3].textContent=e.completedToday);const t=document.getElementById("recentQueue");t&&(t.innerHTML=this.renderRecentQueue());const a=document.getElementById("doctorStatus");a&&(a.innerHTML=this.renderDoctorStatus())},render:()=>'\n        <div class="fade-in">\n            <div class="card">\n                <div class="card-header">\n                    <h2 class="card-title">\n                        <i class="fas fa-tachometer-alt"></i>\n                        Dashboard\n                    </h2>\n                    <p style="margin: 0; color: #64748b;">\n                        Selamat datang di Sistem Manajemen Pasien Rumah Sakit\n                    </p>\n                </div>\n\n                <div class="queue-stats">\n                    <div class="stat-card">\n                        <div class="stat-number loading-placeholder">-</div>\n                        <div class="stat-label">Total Pasien</div>\n                    </div>\n                    <div class="stat-card">\n                        <div class="stat-number loading-placeholder">-</div>\n                        <div class="stat-label">Antrian Hari Ini</div>\n                    </div>\n                    <div class="stat-card">\n                        <div class="stat-number loading-placeholder">-</div>\n                        <div class="stat-label">Dokter Aktif</div>\n                    </div>\n                    <div class="stat-card">\n                        <div class="stat-number loading-placeholder">-</div>\n                        <div class="stat-label">Selesai Hari Ini</div>\n                    </div>\n                </div>\n            </div>\n\n            <div class="dashboard-grid">\n                <div class="card">\n                    <div class="card-header">\n                        <h3 class="card-title">\n                            <i class="fas fa-clock"></i>\n                            Antrian Terbaru\n                        </h3>\n                    </div>\n                    <div id="recentQueue">\n                        <div class="loading-state">\n                            <i class="fas fa-spinner fa-spin"></i>\n                            <p>Memuat data antrian...</p>\n                        </div>\n                    </div>\n                </div>\n\n                <div class="card">\n                    <div class="card-header">\n                        <h3 class="card-title">\n                            <i class="fas fa-user-md"></i>\n                            Status Dokter\n                        </h3>\n                    </div>\n                    <div id="doctorStatus">\n                        <div class="loading-state">\n                            <i class="fas fa-spinner fa-spin"></i>\n                            <p>Memuat data dokter...</p>\n                        </div>\n                    </div>\n                </div>\n            </div>\n\n            <div class="card">\n                <div class="card-header">\n                    <h3 class="card-title">\n                        <i class="fas fa-bolt"></i>\n                        Aksi Cepat\n                    </h3>\n                </div>\n                <div class="quick-actions">\n                    <a href="#face-recognition" class="action-card" data-route="face-recognition">\n                        <i class="fas fa-camera"></i>\n                        <h3>Face Recognition</h3>\n                        <p>Identifikasi pasien dengan wajah</p>\n                    </a>\n                    <a href="#add-patient" class="action-card" data-route="add-patient">\n                        <i class="fas fa-user-plus"></i>\n                        <h3>Tambah Pasien</h3>\n                        <p>Daftarkan pasien baru</p>\n                    </a>\n                    <a href="#queue" class="action-card" data-route="queue">\n                        <i class="fas fa-list-ol"></i>\n                        <h3>Kelola Antrian</h3>\n                        <p>Lihat dan kelola antrian</p>\n                    </a>\n                </div>\n            </div>\n        </div>\n    ',getStats(){const e=(new Date).toDateString(),n=this.queues.filter((n=>new Date(n.timestamp).toDateString()===e)),t=n.filter((e=>"completed"===e.status));return{totalPatients:this.patients.length,queueToday:n.length,activeDoctors:this.doctors.filter((e=>"available"===e.status)).length,completedToday:t.length}},async processQueueData(e){return e.map((e=>{const n=e.patient_id&&"object"==typeof e.patient_id?e.patient_id:this.patients.find((n=>(n._id||n.id)?.toString()===e.patient_id?.toString())),t=e.doctor_id&&"object"==typeof e.doctor_id?e.doctor_id:this.doctors.find((n=>(n._id||n.id)?.toString()===e.doctor_id?.toString()));return{...e,id:e._id||e.id,patientId:e.patient_id?._id||e.patient_id,doctorId:e.doctor_id?._id||e.doctor_id,patientName:n?n.name:"Pasien Tidak Dikenal",doctorName:t?t.name:"Dokter Tidak Dikenal",doctorSpecialty:t?t.specialty:"Spesialisasi Tidak Dikenal"}}))},renderRecentQueue(){const e=this.queues.sort(((e,n)=>new Date(n.timestamp)-new Date(e.timestamp))).slice(0,5);return 0===e.length?'<p style="color: #64748b; text-align: center; padding: 2rem;">Belum ada antrian hari ini</p>':e.map((e=>`\n      <div class="history-item" style="margin-bottom: 1rem;">\n          <div class="history-date">${new Date(e.timestamp).toLocaleString("id-ID")}</div>\n          <div class="history-doctor">${e.patientName||"Pasien Tidak Dikenal"}</div>\n          <div class="history-complaint">\n              Dr. ${e.doctorName||"Dokter Tidak Dikenal"} - \n              <span class="status-badge status-${"waiting"===e.status?"waiting":"examining"===e.status?"examining":"completed"}">\n                  ${"waiting"===e.status?"Menunggu":"examining"===e.status?"Diperiksa":"Selesai"}\n              </span>\n          </div>\n      </div>\n  `)).join("")},renderDoctorStatus(){return this.doctors.map((e=>{const n=e._id||e.id,t=this.queues.filter((e=>(e.doctorId===n||e.doctor_id===n)&&"completed"!==e.status)),a=this.queues.find((e=>(e.doctorId===n||e.doctor_id===n)&&"examining"===e.status));return`\n            <div class="info-item" style="margin-bottom: 1rem; padding: 1rem; background: #f8fafc; border-radius: 0.5rem;">\n                <div class="info-label">Dr. ${e.name}</div>\n                <div class="info-value">${e.specialty}</div>\n                <div style="margin-top: 0.5rem;">\n                    <span class="status-badge ${"available"===e.status?"status-waiting":"status-examining"}">\n                        ${"available"===e.status?"Tersedia":"Sibuk"}\n                    </span>\n                    <small style="margin-left: 0.5rem; color: #64748b;">\n                        ${t.length} antrian\n                    </small>\n                </div>\n                ${a?`\n                    <div style="margin-top: 0.5rem; font-size: 0.875rem; color: #3b82f6;">\n                        Memeriksa: ${a.patientName||"Pasien Tidak Dikenal"}\n                    </div>\n                `:""}\n            </div>\n        `})).join("")},async init(e){this.app=e;const n=this.app.currentUser.token;await this.fetchData(n),this.refreshInterval=setInterval((async()=>{this.app.currentUser&&this.app.currentUser.token&&await this.fetchData(this.app.currentUser.token)}),3e4)},destroy(){this.refreshInterval&&clearInterval(this.refreshInterval)}},E={render:()=>'\n            <div class="fade-in">\n                <div class="card">\n                    <div class="card-header">\n                        <h2 class="card-title">\n                            <i class="fas fa-camera"></i>\n                            Face Recognition\n                        </h2>\n                        <p style="margin: 0; color: #64748b;">\n                            Identifikasi pasien menggunakan teknologi pengenalan wajah\n                        </p>\n                    </div>\n\n                    <div id="cameraSection">\n                        <div class="camera-container">\n                            <div class="camera-placeholder" id="cameraPlaceholder">\n                                <i class="fas fa-camera"></i>\n                                <p>Klik tombol untuk mulai kamera</p>\n                            </div>\n                            <video id="cameraPreview" class="camera-preview" style="display: none;" autoplay muted></video>\n                            <canvas id="captureCanvas" style="display: none;"></canvas>\n                            <button id="captureBtn" class="capture-btn" style="display: none;">\n                                <i class="fas fa-camera"></i>\n                            </button>\n                        </div>\n\n                        <div style="text-align: center; margin-top: 1rem;">\n                            <button id="startCameraBtn" class="btn btn-primary">\n                                <i class="fas fa-video"></i>\n                                Mulai Kamera\n                            </button>\n                            <button id="stopCameraBtn" class="btn btn-secondary" style="display: none;">\n                                <i class="fas fa-video-slash"></i>\n                                Berhenti\n                            </button>\n                        </div>\n                    </div>\n\n                    <div id="capturedSection" style="display: none;">\n                        <h3>Hasil Capture</h3>\n                        <img id="capturedImage" class="captured-image" alt="Captured Image">\n                        \n                        <div id="recognitionResult" class="recognition-result pending">\n                            <i class="fas fa-spinner fa-spin"></i>\n                            <p>Memproses pengenalan wajah...</p>\n                        </div>\n\n                        <div style="text-align: center; margin-top: 1rem;">\n                            <button id="retakeBtn" class="btn btn-secondary">\n                                <i class="fas fa-redo"></i>\n                                Ambil Ulang\n                            </button>\n                        </div>\n                    </div>\n\n                    <div id="verificationSection" style="display: none;">\n                        <div class="recognition-result success">\n                            <i class="fas fa-check-circle"></i>\n                            <p>Pasien berhasil diidentifikasi!</p>\n                        </div>\n                        \n                        <div class="patient-info">\n                            <div class="info-item">\n                                <div class="info-label">Nama Pasien</div>\n                                <div class="info-value" id="recognizedName">-</div>\n                            </div>\n                            <div class="info-item">\n                                <div class="info-label">NIK</div>\n                                <div class="info-value" id="recognizedNik">-</div>\n                            </div>\n                            <div class="info-item">\n                                <div class="info-label">Tanggal Lahir</div>\n                                <div class="info-value" id="recognizedBirth">-</div>\n                            </div>\n                            <div class="info-item">\n                                <div class="info-label">Confidence Score</div>\n                                <div class="info-value" id="confidenceScore">-</div>\n                            </div>\n                        </div>\n\n                        <div style="text-align: center; margin-top: 2rem;">\n                            <h4>Apakah identifikasi ini benar?</h4>\n                            <div style="margin-top: 1rem;">\n                                <button id="confirmCorrect" class="btn btn-success" style="margin-right: 1rem;">\n                                    <i class="fas fa-check"></i>\n                                    Benar\n                                </button>\n                                <button id="confirmIncorrect" class="btn btn-danger">\n                                    <i class="fas fa-times"></i>\n                                    Salah\n                                </button>\n                            </div>\n                        </div>\n                    </div>\n                </div>\n            </div>\n        ',init(e){this.app=e,this.currentStream=null,this.recognizedPatient=null,this.setupEventListeners()},setupEventListeners(){const e=document.getElementById("startCameraBtn"),n=document.getElementById("stopCameraBtn"),t=document.getElementById("captureBtn"),a=document.getElementById("retakeBtn"),i=document.getElementById("confirmCorrect"),o=document.getElementById("confirmIncorrect");e.addEventListener("click",(()=>this.startCamera())),n.addEventListener("click",(()=>this.stopCamera())),t.addEventListener("click",(()=>this.captureImage())),a.addEventListener("click",(()=>this.retakePhoto())),i.addEventListener("click",(()=>this.confirmIdentification(!0))),o.addEventListener("click",(()=>this.confirmIdentification(!1)))},async processFaceRecognition(e){const n=document.getElementById("recognitionResult");n.className="recognition-result pending",n.innerHTML='\n      <i class="fas fa-spinner fa-spin"></i>\n      <p>Memproses pengenalan wajah...</p>\n    ';try{const n=await(0,k.recognizeFace)(e);if(console.log("Recognition result:",n),"matched"===n.status){const e=this.app.getAuthToken(),t=await(0,k.getPatientByName)(n.name,e);if(!t)return this.showNoMatch(),void this.app.showNotification("Pasien dikenali tetapi tidak ditemukan dalam database","error");if(!t._id&&!t.id)throw new Error("Pasien dikenali tetapi tidak memiliki ID yang valid");this.showRecognitionResult(t,n.distance)}else this.showNoMatch()}catch(e){console.error("❌ Gagal proses pengenalan wajah:",e),this.app.showNotification("Gagal mengenali wajah: "+e.message,"error"),this.showNoMatch()}},startCamera:async function(){try{this.currentStream=await b.start("cameraPreview"),document.getElementById("cameraPlaceholder").style.display="none",document.getElementById("cameraPreview").style.display="block",document.getElementById("captureBtn").style.display="block",document.getElementById("startCameraBtn").style.display="none",document.getElementById("stopCameraBtn").style.display="inline-flex"}catch(e){this.app.showNotification("Gagal mengakses kamera: "+e.message,"error")}},stopCamera(){this.currentStream&&(b.stop(this.currentStream),this.currentStream=null),document.getElementById("cameraPlaceholder").style.display="flex",document.getElementById("cameraPreview").style.display="none",document.getElementById("captureBtn").style.display="none",document.getElementById("startCameraBtn").style.display="inline-flex",document.getElementById("stopCameraBtn").style.display="none"},captureImage(){const e=document.getElementById("cameraPreview"),n=document.getElementById("captureCanvas"),t=document.getElementById("capturedImage");n.width=e.videoWidth,n.height=e.videoHeight,n.getContext("2d").drawImage(e,0,0,n.width,n.height);const a=n.toDataURL("image/jpeg",.8);t.src=a,this.stopCamera(),document.getElementById("cameraSection").style.display="none",document.getElementById("capturedSection").style.display="block",this.processFaceRecognition(a)},showRecognitionResult(e,n){this.recognizedPatient=e,document.getElementById("recognizedName").textContent=e.name,document.getElementById("recognizedNik").textContent=e.nik,document.getElementById("recognizedBirth").textContent=new Date(e.birthDate).toLocaleDateString("id-ID"),document.getElementById("confidenceScore").textContent=`Distance: ${n.toFixed(6)}`,document.getElementById("capturedSection").style.display="none",document.getElementById("verificationSection").style.display="block"},showNoMatch(){const e=document.getElementById("recognitionResult");e.className="recognition-result",e.style.background="#fef2f2",e.style.borderColor="#f87171",e.style.color="#dc2626",e.innerHTML='\n            <i class="fas fa-exclamation-triangle"></i>\n            <p>Wajah tidak dikenali dalam database</p>\n            <small>Silakan daftarkan sebagai pasien baru</small>\n        ',setTimeout((()=>{e.innerHTML+='\n                <div style="margin-top: 1rem;">\n                    <button class="btn btn-primary" onclick="hospitalApp.router.navigate(\'add-patient\')">\n                        <i class="fas fa-user-plus"></i>\n                        Daftarkan Pasien Baru\n                    </button>\n                </div>\n            '}),1e3)},confirmIdentification(e){if(e&&this.recognizedPatient){if(!this.recognizedPatient._id&&!this.recognizedPatient.id)return this.app.showNotification("Pasien dikenali tetapi tidak memiliki ID yang valid","error"),void this.retakePhoto();v.set("currentRecognizedPatient",this.recognizedPatient);const e=this.recognizedPatient._id||this.recognizedPatient.id;this.app.router.navigate("patient-record",{patientId:e})}else this.app.showNotification("Identifikasi dibatalkan. Silakan coba lagi.","info"),this.retakePhoto()},retakePhoto(){document.getElementById("capturedSection").style.display="none",document.getElementById("verificationSection").style.display="none",document.getElementById("cameraSection").style.display="block";const e=document.getElementById("recognitionResult");e.className="recognition-result pending",e.innerHTML='\n            <i class="fas fa-spinner fa-spin"></i>\n            <p>Memproses pengenalan wajah...</p>\n        '},destroy(){this.currentStream&&b.stop(this.currentStream)}},S={async render(e){const n=await this.getPatient(e);if(!n)return`\n                <div class="fade-in">\n                    <div class="card">\n                        <div class="card-header">\n                            <h2 class="card-title">\n                                <i class="fas fa-user"></i>\n                                Rekam Medis Pasien\n                            </h2>\n                        </div>\n                        <div style="text-align: center; padding: 2rem;">\n                            <i class="fas fa-exclamation-triangle" style="font-size: 3rem; color: #f59e0b; margin-bottom: 1rem;"></i>\n                            <h3>Pasien tidak ditemukan</h3>\n                            <p style="color: #64748b;">Data pasien dengan ID ${e} tidak dapat ditemukan dalam sistem.</p>\n                            <button class="btn btn-primary" onclick="hospitalApp.router.navigate('dashboard')">\n                                <i class="fas fa-arrow-left"></i>\n                                Kembali ke Dashboard\n                            </button>\n                        </div>\n                    </div>\n                </div>\n            `;const t=n._id||n.id,a=this.getMedicalHistory(t);return await this.loadDoctors(),`\n            <div class="fade-in">\n                <div class="card">\n                    <div class="card-header">\n                        <h2 class="card-title">\n                            <i class="fas fa-user"></i>\n                            Rekam Medis Pasien\n                        </h2>\n                        <button class="btn btn-secondary" onclick="hospitalApp.router.navigate('patients')">\n                            <i class="fas fa-arrow-left"></i>\n                            Kembali ke Daftar Pasien\n                        </button>\n                    </div>\n\n                    <div class="patient-info">\n                        <div class="info-item">\n                            <div class="info-label">ID Pasien</div>\n                            <div class="info-value">${t}</div>\n                        </div>\n                        <div class="info-item">\n                            <div class="info-label">Nama Lengkap</div>\n                            <div class="info-value">${n.name}</div>\n                        </div>\n                        <div class="info-item">\n                            <div class="info-label">NIK</div>\n                            <div class="info-value">${n.nik}</div>\n                        </div>\n                        <div class="info-item">\n                            <div class="info-label">Tanggal Lahir</div>\n                            <div class="info-value">${new Date(n.birthDate).toLocaleDateString("id-ID")}</div>\n                        </div>\n                        <div class="info-item">\n                            <div class="info-label">Umur</div>\n                            <div class="info-value">${this.calculateAge(n.birthDate)} tahun</div>\n                        </div>\n                        <div class="info-item">\n                            <div class="info-label">Jenis Kelamin</div>\n                            <div class="info-value">${this.formatGender(n.gender)}</div>\n                        </div>\n                        <div class="info-item">\n                            <div class="info-label">Alamat</div>\n                            <div class="info-value">${n.address||"-"}</div>\n                        </div>\n                        <div class="info-item">\n                            <div class="info-label">No. Telepon</div>\n                            <div class="info-value">${n.phone||"-"}</div>\n                        </div>\n                        <div class="info-item">\n                            <div class="info-label">Golongan Darah</div>\n                            <div class="info-value">${n.bloodType||"-"}</div>\n                        </div>\n                    </div>\n\n                    <div class="medical-history">\n                        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 1rem;">\n                            <h3>\n                                <i class="fas fa-history"></i>\n                                Riwayat Kunjungan\n                            </h3>\n                            <span style="color: #64748b; font-size: 0.875rem;">\n                                ${a.length} kunjungan\n                            </span>\n                        </div>\n                        \n                        <div id="medicalHistoryList">\n                            ${this.renderMedicalHistory(a)}\n                        </div>\n                    </div>\n                </div>\n\n                <div class="card">\n                    <div class="card-header">\n                        <h3 class="card-title">\n                            <i class="fas fa-plus-circle"></i>\n                            Tambah Kunjungan Baru\n                        </h3>\n                    </div>\n                    \n                    <form id="newVisitForm">\n                        <div class="form-group">\n                            <label class="form-label" for="doctorSelect">Pilih Dokter</label>\n                            <select id="doctorSelect" class="form-select" required>\n                                <option value="">-- Pilih Dokter --</option>\n                                ${this.renderDoctorOptions()}\n                            </select>\n                        </div>\n                        \n                        <div class="form-group">\n                            <label class="form-label" for="complaint">Keluhan</label>\n                            <textarea \n                                id="complaint" \n                                class="form-textarea" \n                                placeholder="Masukkan keluhan pasien..."\n                                required\n                            ></textarea>\n                        </div>\n                        \n                        <div class="form-group">\n                            <label class="form-label" for="priority">Prioritas</label>\n                            <select id="priority" class="form-select" required>\n                                <option value="normal">Normal</option>\n                                <option value="urgent">Mendesak</option>\n                                <option value="emergency">Darurat</option>\n                            </select>\n                        </div>\n                        \n                        <button type="submit" class="btn btn-primary">\n                            <i class="fas fa-plus"></i>\n                            Tambah ke Antrian\n                        </button>\n                    </form>\n                </div>\n            </div>\n        `},async getPatient(e){if(console.log("PatientRecordComponent.getPatient called with ID:",e),!e||"undefined"===e)return console.log("Invalid patientId provided"),null;const n=v.get("currentRecognizedPatient");if(n)return console.log("Found recognized patient:",n.name),n._id||n.id?(v.remove("currentRecognizedPatient"),n):(console.log("Recognized patient has no valid ID"),null);const a=v.get("selectedPatientForQueue");if(a)return console.log("Found selected patient for queue:",a.name),v.remove("selectedPatientForQueue"),a;if(!e)return console.log("No patientId provided"),null;const i=v.get("patients")||[];console.log("Searching in",i.length,"patients for ID:",e);let o=i.find((n=>{const t=n._id?n._id.toString():null,a=n.id?n.id.toString():null,i=e.toString();return t===i||a===i}));if(o)return console.log("Found patient in local storage:",o.name),o;try{console.log("Fetching patient from API with ID:",e);const n=this.app.currentUser.token,a=await Promise.resolve().then(t.bind(t,504));if(o=await a.getPatientById(e,n),o)return console.log("Fetched patient from API:",o.name),i.push(o),v.set("patients",i),o}catch(e){console.error("Failed to fetch patient from API:",e)}return console.log("Patient not found with ID:",e),null},getMedicalHistory(e){console.log("Getting medical history for patient ID:",e);const n=v.get("queue")||[];console.log("Total queue entries:",n.length);const t=e?e.toString():null,a=n.filter((e=>{const n=e.patient_id?(e.patient_id._id||e.patient_id).toString():e.patientId?e.patientId.toString():null,a="completed"===e.status;return n===t&&a})).sort(((e,n)=>new Date(n.timestamp)-new Date(e.timestamp)));return console.log("Found",a.length,"medical history entries for patient"),a},renderMedicalHistory:e=>0===e.length?'\n                <div style="text-align: center; padding: 2rem; color: #64748b;">\n                    <i class="fas fa-clipboard" style="font-size: 2rem; margin-bottom: 1rem; opacity: 0.5;"></i>\n                    <p>Belum ada riwayat kunjungan</p>\n                </div>\n            ':e.map((e=>`\n            <div class="history-item">\n                <div class="history-date">\n                    ${new Date(e.timestamp).toLocaleDateString("id-ID",{weekday:"long",year:"numeric",month:"long",day:"numeric",hour:"2-digit",minute:"2-digit"})}\n                </div>\n                <div class="history-doctor">\n                    <i class="fas fa-user-md"></i>\n                    Dr. ${e.doctorName||"Nama Dokter"} - ${e.doctorSpecialty||"Spesialisasi"}\n                </div>\n                <div class="history-complaint">\n                    <strong>Keluhan:</strong> ${e.complaint||"-"}\n                    ${e.diagnosis?`<br><strong>Diagnosis:</strong> ${e.diagnosis}`:""}\n                    ${e.prescription?`<br><strong>Resep:</strong> ${e.prescription}`:""}\n                </div>\n                ${e.notes?`\n                    <div style="margin-top: 0.5rem; font-size: 0.875rem; color: #64748b;">\n                        <strong>Catatan:</strong> ${e.notes}\n                    </div>\n                `:""}\n            </div>\n        `)).join(""),renderDoctorOptions(){if(console.log("renderDoctorOptions called, doctors:",this.app?.doctors),!this.app||!this.app.doctors||0===this.app.doctors.length)return console.log("No doctors available"),'<option value="" disabled>Loading dokter...</option>';const e=this.app.doctors;console.log("Rendering options for",e.length,"doctors");const n=e.filter((e=>"available"===e.status)).map((e=>`\n                <option value="${e._id}" data-name="${e.name}" data-specialty="${e.specialty}">\n                    Dr. ${e.name} - ${e.specialty}\n                </option>\n            `)).join("");return console.log("Generated options:",n),n},calculateAge(e){if(!e)return 0;const n=new Date,t=new Date(e);let a=n.getFullYear()-t.getFullYear();const i=n.getMonth()-t.getMonth();return(i<0||0===i&&n.getDate()<t.getDate())&&a--,a},formatGender(e){if(!e)return"-";switch(e.toLowerCase()){case"male":return"Laki-laki";case"female":return"Perempuan";case"other":return"Lainnya";default:return"-"}},async init(e,n){console.log("PatientRecordComponent.init called with patientId:",n),this.app=e,this.patientId=n,this.patient=await this.getPatient(n),this.patient?(console.log("Patient loaded:",this.patient.name),await this.loadDoctors(),this.setupEventListeners()):console.log("No patient found, component will show error state")},async loadDoctors(){console.log("Loading doctors...");try{if(!this.app)return void console.error("App not initialized");const e=this.app.currentUser?.token;if(!e)return void console.error("No token available");const n=await Promise.resolve().then(t.bind(t,504));this.app.doctors=await n.getDoctors(e),console.log("Doctors loaded:",this.app.doctors.length),this.updateDoctorDropdown()}catch(e){console.error("Error loading doctors:",e),this.app&&this.app.showNotification&&this.app.showNotification("Gagal mengambil data dokter: "+e.message,"error"),this.app.doctors=[]}},updateDoctorDropdown(){const e=document.getElementById("doctorSelect");if(!e)return;console.log("Updating doctor dropdown..."),e.innerHTML='<option value="">-- Pilih Dokter --</option>';const n=this.renderDoctorOptions();n&&'<option value="" disabled>Loading dokter...</option>'!==n&&(e.innerHTML='<option value="">-- Pilih Dokter --</option>'+n,console.log("Dropdown updated with",this.app.doctors.length,"doctors"))},setupEventListeners(){const e=document.getElementById("newVisitForm");e&&e.addEventListener("submit",(e=>{e.preventDefault(),this.handleNewVisit()}))},getNextQueueNumberForDoctor(e,n){console.log(`Getting next queue number for doctor: ${n}`);const t=new Date,a=t.getFullYear()+"-"+String(t.getMonth()+1).padStart(2,"0")+"-"+String(t.getDate()).padStart(2,"0");console.log(`Today's date: ${a}`);const i=e.filter((e=>{if(!e.timestamp)return console.log("Queue entry without timestamp:",e),!1;const t=new Date(e.timestamp),i=t.getFullYear()+"-"+String(t.getMonth()+1).padStart(2,"0")+"-"+String(t.getDate()).padStart(2,"0"),o=e.doctor_id?"object"==typeof e.doctor_id?e.doctor_id._id||e.doctor_id.id:e.doctor_id:e.doctorId,r=o?.toString()===n.toString(),s=i===a,l="completed"!==e.status&&"cancelled"!==e.status;return console.log(`Queue check - Date: ${i}, Doctor Match: ${r}, Is Today: ${s}, Is Active: ${l}, Status: ${e.status}, QueueNumber: ${e.queueNumber}`),s&&r&&l}));if(console.log(`Found ${i.length} active queues for doctor today`),0===i.length)return console.log("No queues found, starting with queue number 1"),1;const o=i.map((e=>parseInt(e.queueNumber)||0)).filter((e=>e>0));console.log("Existing queue numbers:",o);const r=Math.max(...o,0),s=r+1;return console.log(`Max queue number: ${r}, Next number: ${s}`),s},async handleNewVisit(){const e=document.getElementById("doctorSelect"),n=document.getElementById("complaint"),t=document.getElementById("priority"),a=n.value.trim(),i=t.value;if(!a)return void this.app.showNotification("Harap isi semua field yang diperlukan","error");const o={normal:1,urgent:2,emergency:3}[i]||1,r=e.value,s=this.app.doctors.find((e=>e._id===r));if(!s)return void this.app.showNotification("Dokter tidak ditemukan","error");const l=this.patient._id||this.patient.id;try{this.app.showLoading();const e=this.app.currentUser.token;console.log("Fetching current queues to determine queue number...");const n=await k.getQueues(e);console.log(`Total queues fetched: ${n.length}`);const t=this.getNextQueueNumberForDoctor(n,s._id);console.log(`Assigned queue number: ${t} for doctor: ${s.name}`);const i={patient_id:l,doctor_id:s._id,complaint:a,priority:o,status:"waiting",queueNumber:t,timestamp:(new Date).toISOString()};console.log("Queue data to send:",i);const r=await k.addQueue(i,e);console.log("Queue added successfully:",r),this.app.showModal("Berhasil Ditambahkan",`Pasien ${this.patient.name} telah ditambahkan ke antrian Dr. ${s.name}.\n\nNomor Antrian: ${r.queueNumber||t}`,(()=>{this.app.router.navigate("queue")}));const d=document.getElementById("newVisitForm");d&&d.reset()}catch(e){if(console.error("Error adding queue:",e),e.response)try{const n=await e.response.json();this.app.showNotification("Gagal menambahkan antrian: "+(n.message||e.message),"error")}catch(n){this.app.showNotification("Gagal menambahkan antrian: "+e.message,"error")}else this.app.showNotification("Gagal menambahkan antrian: "+e.message,"error")}finally{this.app.hideLoading()}}},P={render:()=>'\n            <div class="fade-in">\n                <div class="card">\n                    <div class="card-header">\n                        <h2 class="card-title">\n                            <i class="fas fa-user-plus"></i>\n                            Tambah Pasien Baru\n                        </h2>\n                        <button class="btn btn-secondary" onclick="hospitalApp.router.navigate(\'dashboard\')">\n                            <i class="fas fa-arrow-left"></i>\n                            Kembali\n                        </button>\n                    </div>\n\n                    <form id="addPatientForm">\n                        <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 2rem;">\n                            <div>\n                                <h3 style="margin-bottom: 1rem; color: #1e293b;">\n                                    <i class="fas fa-user"></i>\n                                    Informasi Pribadi\n                                </h3>\n                                \n                                <div class="form-group">\n                                    <label class="form-label" for="fullName">Nama Lengkap *</label>\n                                    <input \n                                        type="text" \n                                        id="fullName" \n                                        name="fullName" \n                                        class="form-input" \n                                        placeholder="Masukkan nama lengkap"\n                                        required\n                                    >\n                                </div>\n\n                                <div class="form-group">\n                                    <label class="form-label" for="nik">NIK *</label>\n                                    <input \n                                        type="text" \n                                        id="nik" \n                                        name="nik" \n                                        class="form-input" \n                                        placeholder="Nomor Induk Kependudukan (16 digit)"\n                                        maxlength="16"\n                                        pattern="[0-9]{16}"\n                                        required\n                                    >\n                                </div>\n\n                                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 1rem;">\n                                    <div class="form-group">\n                                        <label class="form-label" for="birthDate">Tanggal Lahir *</label>\n                                        <input \n                                            type="date" \n                                            id="birthDate" \n                                            name="birthDate" \n                                            class="form-input"\n                                            required\n                                        >\n                                    </div>\n\n                                    <div class="form-group">\n                                        <label class="form-label" for="gender">Jenis Kelamin *</label>\n                                        <select id="gender" name="gender" class="form-select" required>\n                                            <option value="">-- Pilih --</option>\n                                            <option value="male">Laki-laki</option>\n                                            <option value="female">Perempuan</option>\n                                            <option value="other">Lainnya</option>\n                                        </select>\n                                    </div>\n                                </div>\n\n                                <div class="form-group">\n                                    <label class="form-label" for="bloodType">Golongan Darah</label>\n                                    <select id="bloodType" name="bloodType" class="form-select">\n                                        <option value="">-- Pilih Golongan Darah --</option>\n                                        <option value="A">A</option>\n                                        <option value="B">B</option>\n                                        <option value="AB">AB</option>\n                                        <option value="O">O</option>\n                                    </select>\n                                </div>\n                            </div>\n\n                            <div>\n                                <h3 style="margin-bottom: 1rem; color: #1e293b;">\n                                    <i class="fas fa-address-card"></i>\n                                    Informasi Kontak\n                                </h3>\n\n                                <div class="form-group">\n                                    <label class="form-label" for="phone">No. Telepon *</label>\n                                    <input \n                                        type="tel" \n                                        id="phone" \n                                        name="phone" \n                                        class="form-input" \n                                        placeholder="Contoh: 08123456789"\n                                        pattern="[0-9]{10,13}"\n                                        required\n                                    >\n                                </div>\n\n                                <div class="form-group">\n                                    <label class="form-label" for="email">Email</label>\n                                    <input \n                                        type="email" \n                                        id="email" \n                                        name="email" \n                                        class="form-input" \n                                        placeholder="contoh@email.com"\n                                    >\n                                </div>\n\n                                <div class="form-group">\n                                    <label class="form-label" for="address">Alamat Lengkap *</label>\n                                    <textarea \n                                        id="address" \n                                        name="address" \n                                        class="form-textarea" \n                                        placeholder="Masukkan alamat lengkap"\n                                        required\n                                    ></textarea>\n                                </div>\n\n                                <div class="form-group">\n                                    <label class="form-label" for="emergencyContact">Kontak Darurat</label>\n                                    <input \n                                        type="text" \n                                        id="emergencyContact" \n                                        name="emergencyContact" \n                                        class="form-input" \n                                        placeholder="No. Telepon kontak darurat"\n                                    >\n                                </div>\n                            </div>\n                        </div>\n\n                        <div class="card" style="margin-top: 2rem;">\n                            <div class="card-header">\n                                <h3 class="card-title">\n                                    <i class="fas fa-camera"></i>\n                                    Foto untuk Face Recognition\n                                </h3>\n                            </div>\n\n                            <div id="photoSection">\n                                <div class="camera-container">\n                                    <div class="camera-placeholder" id="photoPlaceholder">\n                                        <i class="fas fa-camera"></i>\n                                        <p>Klik untuk mengambil foto pasien</p>\n                                    </div>\n                                    <video id="photoCamera" class="camera-preview" style="display: none;" autoplay muted></video>\n                                    <canvas id="photoCanvas" style="display: none;"></canvas>\n                                    <button type="button" id="photoCapture" class="capture-btn" style="display: none;">\n                                        <i class="fas fa-camera"></i>\n                                    </button>\n                                </div>\n\n                                <div class="photos-preview-section" style="margin-top: 1rem;">\n                                    <div style="display: flex; align-items: center; justify-content: space-between; margin-bottom: 1rem;">\n                                        <h4 style="margin: 0; color: #4a5568; font-size: 1rem;">\n                                            <i class="fas fa-images"></i>\n                                            Foto yang Diambil (<span id="photoCounter">0</span>/5)\n                                        </h4>\n                                        <div style="display: flex; gap: 0.5rem;">\n                                            <button type="button" id="startPhotoBtn" class="btn btn-primary btn-sm">\n                                                <i class="fas fa-video"></i>\n                                                Mulai Kamera\n                                            </button>\n                                            <button type="button" id="retakePhotoBtn" class="btn btn-secondary btn-sm" style="display: none;">\n                                                <i class="fas fa-redo"></i>\n                                                Ambil Ulang\n                                            </button>\n                                            <button type="button" id="stopPhotoBtn" class="btn btn-secondary btn-sm" style="display: none;">\n                                                <i class="fas fa-video-slash"></i>\n                                                Berhenti\n                                            </button>\n                                        </div>\n                                    </div>\n                                    \n                                    <div class="photos-horizontal-grid" id="photoContainer">\n                                        <div class="photo-slot-small" id="slot1">\n                                            <span class="slot-number-small">1</span>\n                                            <div class="slot-placeholder-small">\n                                                <i class="fas fa-camera"></i>\n                                            </div>\n                                        </div>\n                                        <div class="photo-slot-small" id="slot2">\n                                            <span class="slot-number-small">2</span>\n                                            <div class="slot-placeholder-small">\n                                                <i class="fas fa-camera"></i>\n                                            </div>\n                                        </div>\n                                        <div class="photo-slot-small" id="slot3">\n                                            <span class="slot-number-small">3</span>\n                                            <div class="slot-placeholder-small">\n                                                <i class="fas fa-camera"></i>\n                                            </div>\n                                        </div>\n                                        <div class="photo-slot-small" id="slot4">\n                                            <span class="slot-number-small">4</span>\n                                            <div class="slot-placeholder-small">\n                                                <i class="fas fa-camera"></i>\n                                            </div>\n                                        </div>\n                                        <div class="photo-slot-small" id="slot5">\n                                            <span class="slot-number-small">5</span>\n                                            <div class="slot-placeholder-small">\n                                                <i class="fas fa-camera"></i>\n                                            </div>\n                                        </div>\n                                    </div>\n                                </div>\n                            </div>\n                        </div>\n\n                        <div style="text-align: center; margin-top: 2rem; padding-top: 2rem; border-top: 1px solid #e2e8f0;">\n                            <button type="submit" class="btn btn-success" style="margin-right: 1rem;">\n                                <i class="fas fa-save"></i>\n                                Simpan Pasien\n                            </button>\n                            <button type="button" class="btn btn-secondary" onclick="hospitalApp.router.navigate(\'dashboard\')">\n                                <i class="fas fa-times"></i>\n                                Batal\n                            </button>\n                        </div>\n                    </form>\n                </div>\n            </div>\n\n            <style>\n                .photos-horizontal-grid {\n                    display: flex;\n                    gap: 0.5rem;\n                    flex-wrap: wrap;\n                    justify-content: flex-start;\n                    align-items: center;\n                }\n\n                .photo-slot-small {\n                    position: relative;\n                    width: 80px;\n                    height: 80px;\n                    border: 2px dashed #cbd5e0;\n                    border-radius: 8px;\n                    display: flex;\n                    align-items: center;\n                    justify-content: center;\n                    background: #f7fafc;\n                    transition: all 0.3s ease;\n                }\n\n                .photo-slot-small:hover {\n                    border-color: #3182ce;\n                    background: #ebf8ff;\n                }\n\n                .photo-slot-small.filled {\n                    border-color: #38a169;\n                    border-style: solid;\n                    background: #f0fff4;\n                }\n\n                .slot-number-small {\n                    position: absolute;\n                    top: -8px;\n                    left: -8px;\n                    background: #3182ce;\n                    color: white;\n                    width: 20px;\n                    height: 20px;\n                    border-radius: 50%;\n                    display: flex;\n                    align-items: center;\n                    justify-content: center;\n                    font-size: 0.75rem;\n                    font-weight: bold;\n                    z-index: 2;\n                }\n\n                .slot-placeholder-small {\n                    display: flex;\n                    flex-direction: column;\n                    align-items: center;\n                    justify-content: center;\n                    color: #a0aec0;\n                    font-size: 1rem;\n                }\n\n                .btn-sm {\n                    padding: 0.5rem 1rem;\n                    font-size: 0.875rem;\n                }\n\n                .photos-preview-section {\n                    background: #f8f9fa;\n                    padding: 1rem;\n                    border-radius: 8px;\n                    border: 1px solid #e9ecef;\n                }\n\n                @media (max-width: 640px) {\n                    .photos-horizontal-grid {\n                        justify-content: center;\n                    }\n                    \n                    .photo-slot-small {\n                        width: 60px;\n                        height: 60px;\n                    }\n                    \n                    .slot-number-small {\n                        width: 16px;\n                        height: 16px;\n                        font-size: 0.625rem;\n                    }\n                }\n            </style>\n        ',init(e){this.app=e,this.currentStream=null,this.capturedPhotoData=null,this.capturedPhotos=[],this.setupEventListeners(),this.setupValidation()},setupEventListeners(){const e=document.getElementById("addPatientForm"),n=document.getElementById("startPhotoBtn"),t=document.getElementById("stopPhotoBtn"),a=document.getElementById("photoCapture"),i=document.getElementById("retakePhotoBtn");e.addEventListener("submit",(e=>{e.preventDefault(),this.handleSubmit()})),n.addEventListener("click",(e=>{e.preventDefault(),e.stopPropagation(),this.startPhotoCapture()})),t.addEventListener("click",(e=>{e.preventDefault(),e.stopPropagation(),this.stopPhotoCapture()})),a.addEventListener("click",(e=>{e.preventDefault(),e.stopPropagation(),this.capturePhoto()})),i.addEventListener("click",(e=>{e.preventDefault(),e.stopPropagation(),this.retakePhoto()}))},setupValidation(){const e=document.getElementById("nik"),n=document.getElementById("phone");e.addEventListener("input",(e=>{e.target.value=e.target.value.replace(/\D/g,"")})),n.addEventListener("input",(e=>{e.target.value=e.target.value.replace(/\D/g,"")}))},async startPhotoCapture(){try{this.currentStream=await b.start("photoCamera"),document.getElementById("photoPlaceholder").style.display="none",document.getElementById("photoCamera").style.display="block",document.getElementById("photoCapture").style.display="block",document.getElementById("startPhotoBtn").style.display="none",document.getElementById("stopPhotoBtn").style.display="inline-flex",this.updateCaptureButton()}catch(e){this.app.showNotification("Gagal mengakses kamera: "+e.message,"error")}},stopPhotoCapture(){this.currentStream&&(b.stop(this.currentStream),this.currentStream=null),document.getElementById("photoPlaceholder").style.display="flex",document.getElementById("photoCamera").style.display="none",document.getElementById("photoCapture").style.display="none",document.getElementById("startPhotoBtn").style.display="inline-flex",document.getElementById("stopPhotoBtn").style.display="none"},capturePhoto(){const e=document.getElementById("photoCamera"),n=document.getElementById("photoCanvas");if(this.capturedPhotos||(this.capturedPhotos=[]),this.capturedPhotos.length>=5)return void this.app.showNotification("Sudah mengambil 5 foto!","info");const t=240;n.width=t,n.height=t;const a=n.getContext("2d");let i,o,r,s;e.videoWidth/e.videoHeight>1?(s=e.videoHeight,r=1*s,i=(e.videoWidth-r)/2,o=0):(r=e.videoWidth,s=r/1,i=0,o=(e.videoHeight-s)/2),a.drawImage(e,i,o,r,s,0,0,t,t);const l=n.toDataURL("image/jpeg",.8);this.capturedPhotos.push(l),this.capturedPhotoData=l,this.updatePhotoPreview(),this.updateCaptureButton(),this.updatePhotoCounter(),this.app.showNotification(`Foto ${this.capturedPhotos.length}/5 berhasil diambil`,"success"),5===this.capturedPhotos.length&&(this.stopPhotoCapture(),this.app.showNotification("Selesai! Sudah mengambil 5 foto untuk face recognition","success")),document.getElementById("retakePhotoBtn").style.display="inline-flex"},updateCaptureButton(){const e=document.getElementById("photoCapture"),n=this.capturedPhotos?this.capturedPhotos.length:0;n>=5?(e.innerHTML='<i class="fas fa-check"></i> Selesai (5/5)',e.disabled=!0):(e.innerHTML=`<i class="fas fa-camera"></i> Ambil Foto (${n}/5)`,e.disabled=!1)},updatePhotoCounter(){const e=document.getElementById("photoCounter");e&&(e.textContent=this.capturedPhotos.length)},updatePhotoPreview(){const e=document.getElementById("photoContainer");if(e){e.innerHTML="";for(let n=0;n<5;n++){const t=document.createElement("div");t.className="photo-slot-small",t.id=`slot${n+1}`;const a=document.createElement("span");if(a.className="slot-number-small",a.textContent=n+1,this.capturedPhotos[n]){t.classList.add("filled");const e=document.createElement("img");e.src=this.capturedPhotos[n],e.style.width="100%",e.style.height="100%",e.style.objectFit="cover",e.style.borderRadius="6px",e.title=`Foto ${n+1}`,t.appendChild(a),t.appendChild(e)}else{const e=document.createElement("div");e.className="slot-placeholder-small",e.innerHTML='<i class="fas fa-camera"></i>',t.appendChild(a),t.appendChild(e)}e.appendChild(t)}}},retakePhoto(){this.capturedPhotos=[],this.capturedPhotoData=null,document.getElementById("photoPlaceholder").style.display="flex",document.getElementById("retakePhotoBtn").style.display="none",document.getElementById("startPhotoBtn").style.display="inline-flex",this.updatePhotoPreview(),this.updatePhotoCounter(),this.updateCaptureButton(),this.app.showNotification("Semua foto dihapus. Silahkan ambil foto ulang.","info")},validateForm(){const e=document.getElementById("addPatientForm"),n=new FormData(e),t=[];["fullName","nik","birthDate","gender","phone","address"].forEach((e=>{if(!n.get(e)||!n.get(e).trim()){const n={fullName:"Nama Lengkap",nik:"NIK",birthDate:"Tanggal Lahir",gender:"Jenis Kelamin",phone:"No. Telepon",address:"Alamat"};t.push(`${n[e]} harus diisi`)}}));const a=n.get("nik");a&&16!==a.length&&t.push("NIK harus 16 digit");const i=n.get("phone");return i&&(i.length<10||i.length>13)&&t.push("Nomor telepon tidak valid (10-13 digit)"),t},async handleSubmit(){const e=this.validateForm();if(e.length>0)this.app.showNotification("Error:\n"+e.join("\n"),"error");else{this.app.showLoading("Menyimpan data pasien...");try{await this.savePatientToBackend()}catch(e){this.app.hideLoading(),this.app.showNotification("Gagal menyimpan pasien: "+e.message,"error")}}},getAuthToken(){let e=v.get("token");if(e)return e;if(this.app&&this.app.currentUser&&this.app.currentUser.token)return this.app.currentUser.token;const n=v.get("currentUser");if(n&&n.token)return n.token;try{const e=sessionStorage.getItem("token");if(e)return e}catch(e){console.warn("Session storage not available")}return null},async savePatientToBackend(){const e=document.getElementById("addPatientForm"),n=new FormData(e),t=this.getAuthToken();if(!t)throw new Error("Token tidak ditemukan. Silakan login ulang.");const a={name:n.get("fullName").trim(),nik:n.get("nik").trim(),birthDate:n.get("birthDate"),gender:n.get("gender"),bloodType:n.get("bloodType")||void 0,phone:n.get("phone").trim(),email:n.get("email").trim()||void 0,address:n.get("address").trim(),emergencyContact:n.get("emergencyContact").trim()||void 0,photos:this.capturedPhotos,embeddings:[],status:"active"};Object.keys(a).forEach((e=>{void 0===a[e]&&delete a[e]})),this.app.showLoading("Menyimpan data pasien...");try{const e=await(0,k.addPatient)(a,t);if(this.app.hideLoading(),this.app.showModal("Pasien Berhasil Ditambahkan",`Pasien ${a.name} telah berhasil didaftarkan.\n\nNIK: ${a.nik}`,(()=>{this.app.router.navigate("dashboard")})),5===this.capturedPhotos.length)try{const e=await(0,k.generateFaceEmbedding)({patient_id:a.name,name:a.name,photos:this.capturedPhotos});console.log("📤 Embedding berhasil dikirim:",e)}catch(e){console.warn("Gagal kirim embedding:",e.message),this.app.showNotification("Pasien disimpan, tapi gagal kirim embedding","warning")}this.savePatientToLocalStorage(a,e)}catch(e){console.error("Backend error:",e);try{this.savePatientToLocalStorage(a),this.app.hideLoading(),this.app.showModal("Pasien Disimpan Lokal",`Pasien ${a.name} berhasil disimpan secara lokal.\n\nCatatan: Data akan disinkronisasi ketika koneksi ke server pulih.\n\nNIK: ${a.nik}`,(()=>{this.app.router.navigate("dashboard")}))}catch(e){throw new Error("Gagal menyimpan ke server dan local storage: "+e.message)}}},savePatientToLocalStorage(e,n=null){const t={id:n?.data?.id||Date.now(),...e,photo:this.capturedPhotoData,registrationDate:(new Date).toISOString(),synced:!!n},a=v.get("patients")||[];return a.push(t),v.set("patients",a),t},destroy(){this.currentStream&&b.stop(this.currentStream)}},D={doctors:[],patients:[],queues:[],async loadPatients(){try{const e=this.app.currentUser.token,n=await(0,k.getPatients)(e);return console.log("Loaded patients:",n),this.patients=n,v.set("patients",n),n}catch(e){return console.error("Failed to load patients:",e),this.patients=v.get("patients")||[],this.patients}},async loadDoctors(){try{const e=this.app.currentUser.token;this.doctors=await(0,k.getDoctors)(e),console.log("Loaded doctors:",this.doctors),v.set("doctors",this.doctors)}catch(e){console.error("Failed to load doctors:",e),this.app.showNotification("Gagal mengambil data dokter: "+e.message,"error"),this.doctors=v.get("doctors")||[]}},async loadQueues(){try{const e=this.app.currentUser.token,n=await(0,k.getQueues)(e);this.queues=await this.processQueueData(n),v.set("queue",this.queues)}catch(e){this.app.showNotification("Gagal mengambil data antrian: "+e.message,"error"),this.queues=v.get("queue")||[]}},formatDateToInput(e){const n=new Date(e);return`${n.getFullYear()}-${String(n.getMonth()+1).padStart(2,"0")}-${String(n.getDate()).padStart(2,"0")}`},formatDateToId:e=>new Date(e).toLocaleDateString("id-ID"),async addQueue(e,n,t,a){try{this.app.showLoading();const i=this.app.currentUser.token;await this.loadQueues();const o={patient_id:e,doctor_id:n,complaint:t,priority:a,status:"waiting",queueNumber:this.getNextQueueNumber(n),timestamp:(new Date).toISOString()},r=await(0,k.addQueue)(o,i);return await this.loadQueues(),this.app.showNotification("Antrian berhasil ditambahkan","success"),this.refreshQueue(),r}catch(e){throw this.app.showNotification("Gagal menambahkan antrian: "+e.message,"error"),e}finally{this.app.hideLoading()}},getNextQueueNumber(e=null){const n=(new Date).toISOString().split("T")[0],t=this.queues.filter((t=>{const a=new Date(t.timestamp).toISOString().split("T")[0],i=!e||t.doctor_id?.toString()===e.toString()||t.doctorId?.toString()===e.toString();return a===n&&i&&"completed"!==t.status}));return 0===t.length?1:t.reduce(((e,n)=>Math.max(e,Number(n.queueNumber)||0)),0)+1},async processQueueData(e){const n=this.patients.length>0?this.patients:await this.loadPatients(),t=this.doctors.length>0?this.doctors:await this.loadDoctors();return e.map((e=>{const a=e.patient_id&&"object"==typeof e.patient_id?e.patient_id:n.find((n=>(n._id||n.id)?.toString()===e.patient_id?.toString())),i=e.doctor_id&&"object"==typeof e.doctor_id?e.doctor_id:t.find((n=>(n._id||n.id)?.toString()===e.doctor_id?.toString()));return{...e,id:e._id||e.id,patientId:a?a._id||a.id:e.patient_id,doctorId:i?i._id||i.id:e.doctor_id,patientName:a?a.name:"Pasien Tidak Dikenal",doctorName:i?`${i.name}`:"Dokter Tidak Dikenal",doctorSpecialty:i?i.specialty:"Spesialisasi Tidak Dikenal",queueNumber:e.queueNumber||1}}))},getCurrentDate(){return this.formatDateToInput(new Date)},render(){const e=this.getQueueStats();return`\n            <div class="fade-in">\n                <div class="card">\n                    <div class="card-header">\n                        <h2 class="card-title">\n                            <i class="fas fa-list-ol"></i>\n                            Antrian Pasien\n                        </h2>\n                        <button class="btn btn-primary" id="refreshQueue">\n                            <i class="fas fa-sync-alt"></i>\n                            Refresh\n                        </button>\n                    </div>\n\n                    <div class="queue-stats">\n                        <div class="stat-card">\n                            <div class="stat-number">${e.waiting}</div>\n                            <div class="stat-label">Menunggu</div>\n                        </div>\n                        <div class="stat-card">\n                            <div class="stat-number">${e.examining}</div>\n                            <div class="stat-label">Sedang Diperiksa</div>\n                        </div>\n                        <div class="stat-card">\n                            <div class="stat-number">${e.completed}</div>\n                            <div class="stat-label">Selesai Hari Ini</div>\n                        </div>\n                        <div class="stat-card">\n                            <div class="stat-number">${e.total}</div>\n                            <div class="stat-label">Total Hari Ini</div>\n                        </div>\n                    </div>\n                </div>\n\n                <div class="card">\n                    <div class="card-header">\n                        <h3 class="card-title">\n                            <i class="fas fa-filter"></i>\n                            Filter Antrian\n                        </h3>\n                    </div>\n                    \n                    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 1rem; margin-bottom: 1rem;">\n                        <div class="form-group mb-0">\n                            <label class="form-label" for="doctorFilter">Filter Dokter</label>\n                            <select id="doctorFilter" class="form-select">\n                                <option value="">Semua Dokter</option>\n                                ${this.renderDoctorFilterOptions()}\n                            </select>\n                        </div>\n                        \n                        <div class="form-group mb-0">\n                            <label class="form-label" for="statusFilter">Filter Status</label>\n                            <select id="statusFilter" class="form-select">\n                                <option value="">Semua Status</option>\n                                <option value="waiting">Menunggu</option>\n                                <option value="examining">Sedang Diperiksa</option>\n                                <option value="completed">Selesai</option>\n                            </select>\n                        </div>\n                        \n                        <div class="form-group mb-0">\n                          <label class="form-label" for="dateFilter">Filter Tanggal</label>\n                          <input type="date" id="dateFilter" class="form-input" value="${this.getCurrentDate()}">\n                        </div>\n                    </div>\n                </div>\n\n                <div class="card">\n                    <div class="card-header">\n                        <h3 class="card-title">Daftar Antrian</h3>\n                        <span id="queueCount" style="color: #64748b; font-size: 0.875rem;">\n                            ${this.getFilteredQueue().length} antrian\n                        </span>\n                    </div>\n                    \n                    <div style="overflow-x: auto;">\n                        <table class="queue-table">\n                            <thead>\n                                <tr>\n                                    <th>No. Antrian</th>\n                                    <th>Waktu</th>\n                                    <th>Nama Pasien</th>\n                                    <th>Dokter</th>\n                                    <th>Keluhan</th>\n                                    <th>Prioritas</th>\n                                    <th>Status</th>\n                                    <th>Aksi</th>\n                                </tr>\n                            </thead>\n                            <tbody id="queueTableBody">\n                                ${this.renderQueueTable()}\n                            </tbody>\n                        </table>\n                    </div>\n                </div>\n            </div>\n        `},getQueueStats(){const e=this.getFilteredQueue(),n=(new Date).toDateString(),t=e.filter((e=>new Date(e.timestamp).toDateString()===n));return{waiting:t.filter((e=>"waiting"===e.status)).length,examining:t.filter((e=>"examining"===e.status)).length,completed:t.filter((e=>"completed"===e.status)).length,total:t.length}},getFilteredQueue(){const e=this.queues||[],n=document.getElementById("doctorFilter")?.value||"",t=document.getElementById("statusFilter")?.value||"",a=document.getElementById("dateFilter"),i=a?.value||this.getCurrentDate();return e.filter((e=>{const a=this.formatDateToInput(e.timestamp),o=e.doctorId||e.doctor_id,r=!n||o?.toString()===n,s=!t||e.status===t;return r&&s&&(!i||a===i)})).sort(((e,n)=>{const t={emergency:3,urgent:2,normal:1},a="number"==typeof e.priority?3===e.priority?"emergency":2===e.priority?"urgent":"normal":e.priority,i=(t["number"==typeof n.priority?3===n.priority?"emergency":2===n.priority?"urgent":"normal":n.priority]||1)-(t[a]||1);return 0!==i?i:new Date(e.timestamp)-new Date(n.timestamp)}))},renderDoctorFilterOptions(){return this.doctors.map((e=>`\n            <option value="${e._id||e.id}">Dr. ${e.name} - ${e.specialty}</option>\n        `)).join("")},renderQueueTable(){const e=this.getFilteredQueue();return 0===e.length?'\n                <tr>\n                    <td colspan="8" style="text-align: center; padding: 2rem; color: #64748b;">\n                        <i class="fas fa-inbox" style="font-size: 2rem; margin-bottom: 1rem; opacity: 0.5; display: block;"></i>\n                        Tidak ada antrian untuk filter yang dipilih\n                    </td>\n                </tr>\n            ':e.map((e=>`\n            <tr>\n                <td>\n                    <strong style="font-size: 1.2rem; color: #3b82f6;">\n                        #${e.queueNumber}\n                    </strong>\n                </td>\n                <td>\n                    <div style="font-size: 0.875rem;">\n                        ${new Date(e.timestamp).toLocaleDateString("id-ID")}\n                    </div>\n                    <div style="font-size: 0.75rem; color: #64748b;">\n                      ${this.formatDateToId(e.timestamp)}\n                    </div>\n                </td>\n                <td>\n                    <strong>${e.patientName}</strong>\n                </td>\n                <td>\n                    <div>Dr. ${e.doctorName}</div>\n                    <div style="font-size: 0.875rem; color: #64748b;">${e.doctorSpecialty}</div>\n                </td>\n                <td>\n                    <div style="max-width: 200px; overflow: hidden; text-overflow: ellipsis; white-space: nowrap;" title="${e.complaint}">\n                        ${e.complaint}\n                    </div>\n                </td>\n                <td>\n                    <span class="status-badge ${this.getPriorityClass(e.priority)}">\n                        ${this.getPriorityLabel(e.priority)}\n                    </span>\n                </td>\n                <td>\n                    <span class="status-badge status-${e.status}">\n                        ${this.getStatusLabel(e.status)}\n                    </span>\n                </td>\n                <td>\n                    <div style="display: flex; gap: 0.25rem; flex-wrap: wrap;">\n                        ${this.renderActionButtons(e)}\n                    </div>\n                </td>\n            </tr>\n        `)).join("")},getPriorityClass(e){switch("number"==typeof e?3===e?"emergency":2===e?"urgent":"normal":e){case"emergency":return"status-completed";case"urgent":return"status-examining";default:return"status-waiting"}},getPriorityLabel(e){switch("number"==typeof e?3===e?"emergency":2===e?"urgent":"normal":e){case"emergency":return"Darurat";case"urgent":return"Mendesak";default:return"Normal"}},getStatusLabel(e){switch(e){case"waiting":return"Menunggu";case"examining":return"Diperiksa";case"completed":return"Selesai";default:return e}},renderActionButtons(e){const n=e._id||e.id;switch(e.status){case"waiting":return`\n                    <button class="btn btn-primary" style="font-size: 0.75rem; padding: 0.25rem 0.5rem;" \n                            onclick="queueComponent.startExamination('${n}')">\n                        <i class="fas fa-play"></i>\n                        Mulai\n                    </button>\n                `;case"examining":return`\n                    <button class="btn btn-success" style="font-size: 0.75rem; padding: 0.25rem 0.5rem;" \n                            onclick="queueComponent.completeExamination('${n}')">\n                        <i class="fas fa-check"></i>\n                        Selesai\n                    </button>\n                `;case"completed":return`\n                    <button class="btn btn-secondary" style="font-size: 0.75rem; padding: 0.25rem 0.5rem;" \n                            onclick="queueComponent.viewDetails('${n}')">\n                        <i class="fas fa-eye"></i>\n                        Detail\n                    </button>\n                `;default:return""}},async init(e){this.app=e,window.queueComponent=this,this.app.showLoading(),this.refreshInterval&&clearInterval(this.refreshInterval);try{await this.loadDoctors(),await this.loadPatients(),await this.loadQueues();const e=document.getElementById("app-content");e&&(e.innerHTML=this.render()),this.setupEventListeners()}catch(e){console.error("Error initializing queue:",e),this.app.showNotification("Gagal memuat data antrian","error")}finally{this.app.hideLoading()}},setupEventListeners(){const e=document.getElementById("refreshQueue"),n=document.getElementById("doctorFilter"),t=document.getElementById("statusFilter"),a=document.getElementById("dateFilter");e.addEventListener("click",(()=>this.refreshQueue())),[n,t,a].forEach((e=>{e&&e.addEventListener("change",(()=>this.refreshQueue()))}))},async refreshQueue(){this.app.showLoading();try{await this.loadPatients(),await this.loadDoctors(),await this.loadQueues();const e=document.getElementById("queueTableBody"),n=document.getElementById("queueCount");e&&(e.innerHTML=this.renderQueueTable()),n&&(n.textContent=`${this.getFilteredQueue().length} antrian`);const t=this.getQueueStats(),a=document.querySelectorAll(".stat-card .stat-number");a.length>=4&&(a[0].textContent=t.waiting,a[1].textContent=t.examining,a[2].textContent=t.completed,a[3].textContent=t.total)}catch(e){console.error("Error refreshing queue:",e),this.app.showNotification("Gagal memperbarui antrian","error")}finally{this.app.hideLoading()}},startExamination(e){const n=this.queues.find((n=>n._id&&n._id.toString()===e.toString()||n.id&&n.id.toString()===e.toString()));n?this.app.showModal("Konfirmasi",`Mulai pemeriksaan untuk pasien ${n.patientName}?`,(async()=>{try{this.app.showLoading();const t=this.app.currentUser.token,a={status:"examining",examinationStartTime:(new Date).toISOString()};await(0,k.updateQueue)(e,a,t),await this.loadQueues();const i=v.get("doctors")||[],o=n.doctorId||n.doctor_id,r=i.find((e=>e._id&&e._id.toString()===o?.toString()||e.id&&e.id.toString()===o?.toString()));r&&(r.status="busy",v.set("doctors",i)),this.refreshQueue(),this.app.showNotification(`Pemeriksaan untuk ${n.patientName} telah dimulai`,"success")}catch(e){this.app.showNotification("Gagal memulai pemeriksaan: "+e.message,"error")}finally{this.app.hideLoading()}}),!0):this.app.showNotification("Item antrian tidak ditemukan","error")},completeExamination(e){const n=this.queues.find((n=>n._id&&n._id.toString()===e.toString()||n.id&&n.id.toString()===e.toString()));n?this.showCompletionForm(n):this.app.showNotification("Item antrian tidak ditemukan","error")},showCompletionForm(e){const n=`\n            <div class="custom-modal-overlay">\n                <div class="custom-modal">\n                    <div class="custom-modal-header">\n                        <h3>Selesaikan Pemeriksaan - ${e.patientName}</h3>\n                        <button class="custom-modal-close-btn">\n                            <i class="fas fa-times"></i>\n                        </button>\n                    </div>\n                    <div class="custom-modal-body">\n                        <form id="completionForm">\n                            <div class="form-group">\n                                <label class="form-label">Diagnosis</label>\n                                <textarea class="form-textarea" id="diagnosis" placeholder="Masukkan diagnosis..." required></textarea>\n                            </div>\n                            <div class="form-group">\n                                <label class="form-label">Resep/Obat</label>\n                                <textarea class="form-textarea" id="prescription" placeholder="Masukkan resep obat..."></textarea>\n                            </div>\n                            <div class="form-group">\n                                <label class="form-label">Catatan Tambahan</label>\n                                <textarea class="form-textarea" id="notes" placeholder="Catatan tambahan..."></textarea>\n                            </div>\n                        </form>\n                    </div>\n                    <div class="custom-modal-footer">\n                        <button class="btn btn-success" id="completeBtn">\n                            <i class="fas fa-check"></i>\n                            Selesai\n                        </button>\n                        <button class="btn btn-secondary" id="cancelBtn">Batal</button>\n                    </div>\n                </div>\n            </div>\n        `;document.body.insertAdjacentHTML("beforeend",n);const t=document.querySelector(".custom-modal-overlay"),a=t.querySelector(".custom-modal-close-btn"),i=t.querySelector("#cancelBtn"),o=t.querySelector("#completeBtn");document.body.classList.add("modal-open");const r=()=>{t&&(t.classList.remove("show"),document.body.classList.remove("modal-open"),t.addEventListener("transitionend",(()=>{t.remove()}),{once:!0}))};a.addEventListener("click",r),i.addEventListener("click",r),t.addEventListener("click",(e=>{e.target===t&&r()})),o.addEventListener("click",(()=>{const n=document.getElementById("diagnosis").value.trim(),t=document.getElementById("prescription").value.trim(),a=document.getElementById("notes").value.trim();n?(this.finalizeExamination(e,{diagnosis:n,prescription:t,notes:a}),r()):this.app.showNotification("Diagnosis harus diisi","error")})),setTimeout((()=>{t.classList.add("show")}),10)},async finalizeExamination(e,n){try{this.app.showLoading();const t=this.app.currentUser.token,a={status:"completed",completionTime:(new Date).toISOString(),diagnosis:n.diagnosis,prescription:n.prescription,notes:n.notes};await(0,k.updateQueue)(e._id||e.id,a,t),await this.loadQueues();const i=v.get("doctors")||[],o=e.doctorId||e.doctor_id,r=i.find((e=>e._id&&e._id.toString()===o?.toString()||e.id&&e.id.toString()===o?.toString()));r&&(r.status="available",v.set("doctors",i)),this.refreshQueue(),this.app.showNotification(`Pemeriksaan untuk ${e.patientName} telah selesai`,"success")}catch(e){console.error("Failed to finalize examination:",e),this.app.showNotification("Gagal menyelesaikan pemeriksaan: "+e.message,"error"),this.refreshQueue()}finally{this.app.hideLoading()}},viewDetails(e){const n=this.queues.find((n=>n._id&&n._id.toString()===e.toString()||n.id&&n.id.toString()===e.toString()));if(!n)return void this.app.showNotification("Detail tidak ditemukan","error");const t=`\n      <div class="custom-modal-overlay show">\n        <div class="custom-modal">\n          <div class="custom-modal-header">\n            <h3>Detail Pemeriksaan - ${n.patientName}</h3>\n            <button class="custom-modal-close-btn">\n              <i class="fas fa-times"></i>\n            </button>\n          </div>\n          <div class="custom-modal-body">\n            <div class="detail-section">\n              <h4>Informasi Pasien</h4>\n              <div class="detail-row">\n                <span class="detail-label">Nama Pasien:</span>\n                <span class="detail-value">${n.patientName}</span>\n              </div>\n              <div class="detail-row">\n                <span class="detail-label">Dokter:</span>\n                <span class="detail-value">Dr. ${n.doctorName} (${n.doctorSpecialty})</span>\n              </div>\n              <div class="detail-row">\n                <span class="detail-label">Tanggal:</span>\n                <span class="detail-value">${new Date(n.timestamp).toLocaleDateString("id-ID")}</span>\n              </div>\n              <div class="detail-row">\n                <span class="detail-label">Keluhan:</span>\n                <span class="detail-value">${n.complaint||"-"}</span>\n              </div>\n              <div class="detail-row">\n                <span class="detail-label">Prioritas:</span>\n                <span class="detail-value">${this.getPriorityLabel(n.priority)}</span>\n              </div>\n            </div>\n  \n            <div class="detail-section">\n              <h4>Hasil Pemeriksaan</h4>\n              <div class="detail-row">\n                <span class="detail-label">Diagnosis:</span>\n                <span class="detail-value">${n.diagnosis||"-"}</span>\n              </div>\n              <div class="detail-row">\n                <span class="detail-label">Resep Obat:</span>\n                <span class="detail-value">${n.prescription||"-"}</span>\n              </div>\n              <div class="detail-row">\n                <span class="detail-label">Catatan:</span>\n                <span class="detail-value">${n.notes||"-"}</span>\n              </div>\n            </div>\n  \n            <div class="detail-section">\n              <h4>Waktu Pemeriksaan</h4>\n              <div class="detail-row">\n                <span class="detail-label">Mulai:</span>\n                <span class="detail-value">${n.examinationStartTime?new Date(n.examinationStartTime).toLocaleString("id-ID"):"-"}</span>\n              </div>\n              <div class="detail-row">\n                <span class="detail-label">Selesai:</span>\n                <span class="detail-value">${n.completionTime?new Date(n.completionTime).toLocaleString("id-ID"):"-"}</span>\n              </div>\n            </div>\n          </div>\n          <div class="custom-modal-footer">\n            <button class="btn btn-secondary" id="closeDetailBtn">Tutup</button>\n          </div>\n        </div>\n      </div>\n    `,a=document.querySelector(".custom-modal-overlay");a&&a.remove(),document.body.insertAdjacentHTML("beforeend",t),document.body.classList.add("modal-open");const i=document.querySelector(".custom-modal-close-btn"),o=document.getElementById("closeDetailBtn"),r=document.querySelector(".custom-modal-overlay"),s=()=>{r.classList.remove("show"),document.body.classList.remove("modal-open"),setTimeout((()=>{r.remove()}),300)};i.addEventListener("click",s),o.addEventListener("click",s),r.addEventListener("click",(e=>{e.target===r&&s()}))},destroy(){this.refreshInterval&&clearInterval(this.refreshInterval),window.queueComponent===this&&delete window.queueComponent}},I={render:()=>'\n            <div class="fade-in">\n                <div class="card">\n                    <div class="card-header">\n                        <h2 class="card-title">\n                            <i class="fas fa-users"></i>\n                            Daftar Pasien\n                        </h2>\n                        <div style="display: flex; gap: 1rem;">\n                            <button class="btn btn-primary" id="refreshPatients">\n                                <i class="fas fa-sync-alt"></i>\n                                Refresh\n                            </button>\n                            <button class="btn btn-success" onclick="hospitalApp.router.navigate(\'add-patient\')">\n                                <i class="fas fa-user-plus"></i>\n                                Tambah Pasien\n                            </button>\n                        </div>\n                    </div>\n\n                    <div class="search-filter-section">\n                        <div class="form-group mb-0">\n                            <label class="form-label" for="searchPatients">Cari Pasien</label>\n                            <input \n                                type="text" \n                                id="searchPatients" \n                                class="form-input" \n                                placeholder="Cari berdasarkan nama, NIK, atau telepon..."\n                            >\n                        </div>\n                        <div class="form-group mb-0">\n                            <label class="form-label" for="genderFilter">Filter Jenis Kelamin</label>\n                            <select id="genderFilter" class="form-select">\n                                <option value="">Semua</option>\n                                <option value="male">Laki-laki</option>\n                                <option value="female">Perempuan</option>\n                            </select>\n                        </div>\n                        <div class="form-group mb-0">\n                            <label class="form-label" for="bloodTypeFilter">Filter Golongan Darah</label>\n                            <select id="bloodTypeFilter" class="form-select">\n                                <option value="">Semua</option>\n                                <option value="A">A</option>\n                                <option value="B">B</option>\n                                <option value="AB">AB</option>\n                                <option value="O">O</option>\n                            </select>\n                        </div>\n                        <div class="form-group mb-0">\n                            <label class="form-label" for="statusFilter">Filter Status</label>\n                            <select id="statusFilter" class="form-select">\n                                <option value="">Semua</option>\n                                <option value="active">Aktif</option>\n                                <option value="inactive">Tidak Aktif</option>\n                            </select>\n                        </div>\n                    </div>\n\n                    <div class="queue-stats">\n                        <div class="stat-card">\n                            <div class="stat-number" id="totalPatients">0</div>\n                            <div class="stat-label">Total Pasien</div>\n                        </div>\n                        <div class="stat-card">\n                            <div class="stat-number" id="activePatients">0</div>\n                            <div class="stat-label">Pasien Aktif</div>\n                        </div>\n                        <div class="stat-card">\n                            <div class="stat-number" id="malePatients">0</div>\n                            <div class="stat-label">Laki-laki</div>\n                        </div>\n                        <div class="stat-card">\n                            <div class="stat-number" id="femalePatients">0</div>\n                            <div class="stat-label">Perempuan</div>\n                        </div>\n                    </div>\n                </div>\n\n                <div class="card">\n                    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 1rem;">\n                        <h3>\n                            <span id="filteredCount">0</span> pasien ditemukan\n                        </h3>\n                        <div style="display: flex; gap: 0.5rem;">\n                            <button class="btn btn-secondary" id="cardViewBtn">\n                                <i class="fas fa-th-large"></i>\n                                Card View\n                            </button>\n                            <button class="btn btn-primary" id="tableViewBtn">\n                                <i class="fas fa-table"></i>\n                                Table View\n                            </button>\n                        </div>\n                    </div>\n\n                    <div id="tableView" style="overflow-x: auto;">\n                        <table class="patients-table">\n                            <thead>\n                                <tr>\n                                    <th>Foto</th>\n                                    <th>Nama Lengkap</th>\n                                    <th>NIK</th>\n                                    <th>Umur</th>\n                                    <th>Jenis Kelamin</th>\n                                    <th>Golongan Darah</th>\n                                    <th>No. Telepon</th>\n                                    <th>Status</th>\n                                    <th>Aksi</th>\n                                </tr>\n                            </thead>\n                            <tbody id="patientsTableBody">\n                                </tbody>\n                        </table>\n                    </div>\n\n                    <div id="cardView" style="display: none;">\n                        <div id="patientsCardContainer">\n                            </div>\n                    </div>\n                </div>\n            </div>\n        ',init(e){this.app=e,this.currentView="table",this.allPatients=[],this.filteredPatients=[],this.setupEventListeners(),this.loadPatients(),this.updateStatistics()},setupEventListeners(){const e=document.getElementById("searchPatients"),n=document.getElementById("genderFilter"),t=document.getElementById("bloodTypeFilter"),a=document.getElementById("statusFilter"),i=document.getElementById("refreshPatients"),o=document.getElementById("cardViewBtn"),r=document.getElementById("tableViewBtn");e&&e.addEventListener("input",(()=>this.filterPatients())),[n,t,a].forEach((e=>{e&&e.addEventListener("change",(()=>this.filterPatients()))})),i&&i.addEventListener("click",(()=>this.refreshData())),o&&o.addEventListener("click",(()=>this.switchView("card"))),r&&r.addEventListener("click",(()=>this.switchView("table")))},async loadPatients(){this.app.showLoading();try{const e=this.app.currentUser.token,n=await Promise.resolve().then(t.bind(t,504)).then((n=>n.getPatients(e)));this.allPatients=n,this.filteredPatients=[...n],this.app.storage.set("patients",n),this.renderPatients(),this.updateStatistics()}catch(e){this.app.showNotification("Gagal mengambil data pasien: "+e.message,"error")}finally{this.app.hideLoading()}},async deletePatient(e){try{const n=this.app.currentUser.token,a=await Promise.resolve().then(t.bind(t,504));if(!confirm("Apakah Anda yakin ingin menghapus pasien ini?"))return;await a.deletePatient(e,n),this.app.showNotification("Pasien berhasil dihapus","success"),this.refreshData()}catch(e){console.error("Gagal menghapus pasien:",e),this.app.showNotification("Gagal menghapus pasien: "+e.message,"error")}},filterPatients(){console.log("--- Memulai proses filter pasien ---");const e=document.getElementById("genderFilter"),n=e?e.value:"";console.log(`Nilai filter jenis kelamin yang dipilih: '${n}'`),this.allPatients&&0!==this.allPatients.length?(console.log(`Memfilter dari total ${this.allPatients.length} pasien.`),console.log("Contoh data gender dari beberapa pasien pertama:",this.allPatients.slice(0,5).map((e=>e.gender)))):console.warn("Daftar semua pasien (this.allPatients) kosong. Tidak dapat memfilter.");const t=document.getElementById("searchPatients")?.value.toLowerCase()||"",a=document.getElementById("genderFilter")?.value||"",i=document.getElementById("bloodTypeFilter")?.value||"",o=document.getElementById("statusFilter")?.value||"";this.filteredPatients=this.allPatients.filter((e=>{const n=!t||e.name&&e.name.toLowerCase().includes(t)||e.nik&&e.nik.includes(t)||e.phone&&e.phone.includes(t),r=e.gender?e.gender.toLowerCase():void 0,s=a?a.toLowerCase():void 0,l=!s||r===s,d=!i||e.bloodType===i,c=!o||e.status===o;return n&&l&&d&&c})),console.log(`--- Proses filter selesai. Ditemukan ${this.filteredPatients.length} pasien. ---`),this.renderPatients(),this.updateFilteredCount()},renderPatients(){"table"===this.currentView?this.renderTableView():this.renderCardView()},renderTableView(){const e=document.getElementById("patientsTableBody");e&&(0!==this.filteredPatients.length?e.innerHTML=this.filteredPatients.map((e=>{const n=e._id||e.id;return`\n            <tr>\n                <td>\n                    <div class="patient-avatar" style="width: 40px; height: 40px; font-size: 1rem;">\n                        ${e.photo?`<img src="${e.photo}" class="patient-photo" alt="${e.name}">`:e.name.charAt(0).toUpperCase()}\n                    </div>\n                </td>\n                <td>\n                    <strong>${e.name}</strong>\n                </td>\n                <td>${e.nik}</td>\n                <td>${this.calculateAge(e.birthDate)} tahun</td>\n                <td>${this.formatGender(e.gender)}</td>\n                <td>${e.bloodType||"-"}</td>\n                <td>${e.phone}</td>\n                <td>\n                    <span class="status-badge status-${e.status||"active"}">\n                        ${"inactive"===e.status?"Tidak Aktif":"Aktif"}\n                    </span>\n                </td>\n                <td>\n                    <div style="display: flex; gap: 0.25rem; flex-wrap: wrap;">\n                        <button class="btn btn-primary" style="font-size: 0.75rem; padding: 0.25rem 0.5rem;"\n                                onclick="patientsComponent.viewPatientDetail('${n}')">\n                            <i class="fas fa-eye"></i>\n                            Detail\n                        </button>\n                        <button class="btn btn-success" style="font-size: 0.75rem; padding: 0.25rem 0.5rem;"\n                                onclick="patientsComponent.addToQueue('${n}')">\n                            <i class="fas fa-plus"></i>\n                            Antri\n                        </button>\n                         <button class="btn btn-danger" style="font-size: 0.75rem; padding: 0.25rem 0.5rem;"\n                                onclick="patientsComponent.deletePatient('${n}')">\n                            <i class="fas fa-trash"></i>\n                            Hapus\n                        </button>\n                    </div>\n                </td>\n            </tr>\n        `})).join(""):e.innerHTML='\n                <tr>\n                    <td colspan="9" style="text-align: center; padding: 2rem; color: #64748b;">\n                        <i class="fas fa-users" style="font-size: 2rem; margin-bottom: 1rem; opacity: 0.5; display: block;"></i>\n                        Tidak ada pasien ditemukan\n                    </td>\n                </tr>\n            ')},renderCardView(){const e=document.getElementById("patientsCardContainer");e&&(0!==this.filteredPatients.length?e.innerHTML=this.filteredPatients.map((e=>{const n=e._id||e.id;return`\n            <div class="patient-card">\n                <div class="patient-header">\n                    <div class="patient-avatar">\n                        ${e.photo?`<img src="${e.photo}" style="width: 100%; height: 100%; border-radius: 50%; object-fit: cover;" alt="${e.name}">`:e.name.charAt(0).toUpperCase()}\n                    </div>\n                    <div style="flex: 1;">\n                        <h3 style="margin: 0; color: #1e293b;">${e.name}</h3>\n                        <p style="margin: 0; color: #64748b;">NIK: ${e.nik}</p>\n                        <span class="status-badge status-${e.status||"active"}" style="margin-top: 0.5rem; display: inline-block;">\n                            ${"inactive"===e.status?"Tidak Aktif":"Aktif"}\n                        </span>\n                    </div>\n                    <div style="display: flex; flex-direction: column; gap: 0.5rem;">\n                        <button class="btn btn-primary" style="font-size: 0.875rem; padding: 0.5rem 1rem;"\n                                onclick="patientsComponent.viewPatientDetail('${n}')">\n                            <i class="fas fa-eye"></i>\n                            Detail\n                        </button>\n                        <button class="btn btn-success" style="font-size: 0.875rem; padding: 0.5rem 1rem;"\n                                onclick="patientsComponent.addToQueue('${n}')">\n                            <i class="fas fa-plus"></i>\n                            Tambah Antrian\n                        </button>\n                    </div>\n                </div>\n\n                <div class="patient-info">\n                    <div class="info-item">\n                        <div class="info-label">Umur</div>\n                        <div class="info-value">${this.calculateAge(e.birthDate)} tahun</div>\n                    </div>\n                    <div class="info-item">\n                        <div class="info-label">Jenis Kelamin</div>\n                        <div class="info-value">${this.formatGender(e.gender)}</div>\n                    </div>\n                    <div class="info-item">\n                        <div class="info-label">Golongan Darah</div>\n                        <div class="info-value">${e.bloodType||"-"}</div>\n                    </div>\n                    <div class="info-item">\n                        <div class="info-label">No. Telepon</div>\n                        <div class="info-value">${e.phone}</div>\n                    </div>\n                    <div class="info-item">\n                        <div class="info-label">Alamat</div>\n                        <div class="info-value">${e.address}</div>\n                    </div>\n                    <div class="info-item">\n                        <div class="info-label">Terdaftar</div>\n                        <div class="info-value">${new Date(e.registrationDate).toLocaleDateString("id-ID")}</div>\n                    </div>\n                </div>\n            </div>\n        `})).join(""):e.innerHTML='\n                <div style="text-align: center; padding: 3rem; color: #64748b;">\n                    <i class="fas fa-users" style="font-size: 3rem; margin-bottom: 1rem; opacity: 0.5;"></i>\n                    <h3>Tidak ada pasien ditemukan</h3>\n                    <p>Coba ubah filter pencarian atau tambah pasien baru</p>\n                </div>\n            ')},switchView(e){this.currentView=e;const n=document.getElementById("tableView"),t=document.getElementById("cardView"),a=document.getElementById("tableViewBtn"),i=document.getElementById("cardViewBtn");"table"===e?(n.style.display="block",t.style.display="none",a.classList.add("btn-primary"),a.classList.remove("btn-secondary"),i.classList.add("btn-secondary"),i.classList.remove("btn-primary")):(n.style.display="none",t.style.display="block",i.classList.add("btn-primary"),i.classList.remove("btn-secondary"),a.classList.add("btn-secondary"),a.classList.remove("btn-primary")),this.renderPatients()},updateStatistics(){const e=this.allPatients||[],n=e.length,t=e.filter((e=>"inactive"!==e.status)).length,a=e.filter((e=>e.gender&&"male"===e.gender.toLowerCase())).length,i=e.filter((e=>e.gender&&"female"===e.gender.toLowerCase())).length;document.getElementById("totalPatients").textContent=n,document.getElementById("activePatients").textContent=t,document.getElementById("malePatients").textContent=a,document.getElementById("femalePatients").textContent=i},updateFilteredCount(){const e=document.getElementById("filteredCount");e&&(e.textContent=this.filteredPatients.length)},calculateAge(e){if(!e)return"-";const n=new Date,t=new Date(e);let a=n.getFullYear()-t.getFullYear();const i=n.getMonth()-t.getMonth();return(i<0||0===i&&n.getDate()<t.getDate())&&a--,a},formatGender(e){if(!e)return"-";switch(e.toLowerCase()){case"male":return"Laki-laki";case"female":return"Perempuan";case"other":return"Lainnya";default:return"-"}},viewPatientDetail(e){console.log("Navigating to patient detail with ID:",e),this.app.router.navigate("patient-record",{patientId:String(e)})},addToQueue(e){console.log("Adding patient to queue with ID:",e);const n=this.allPatients.find((n=>(n._id||n.id)===e));n?(this.app.storage.set("selectedPatientForQueue",n),this.app.router.navigate("patient-record",{patientId:String(e)})):(console.error("Patient not found with ID:",e),this.app.showNotification("Pasien tidak ditemukan","error"))},refreshData(){this.loadPatients(),this.updateStatistics(),this.app.showNotification("Data pasien berhasil diperbarui","success")},destroy(){}};class B{constructor(){this.router=new y,this.storage=v,this.currentUser=null,this.isAuthenticated=!1,this.init()}getAuthToken(){return localStorage.getItem("authToken")}init(){this.storage.init(),this.checkAuthState(),this.setupRoutes(),this.setupEventListeners(),this.start()}checkAuthState(){if(localStorage.getItem("authToken")){const e=this.storage.get("currentUser");e&&(this.currentUser=e,this.isAuthenticated=!0)}}setupRoutes(){this.router.addRoute("login",(()=>{this.isAuthenticated?this.router.navigate("dashboard"):this.showLogin()})),this.router.addRoute("dashboard",(()=>{this.requireAuth((()=>this.showDashboard()))})),this.router.addRoute("face-recognition",(()=>{this.requireAuth((()=>this.showFaceRecognition()))})),this.router.addRoute("patients",(()=>{this.requireAuth((()=>this.showPatients()))})),this.router.addRoute("patient-record",(()=>{this.requireAuth((()=>this.showPatientRecord()))})),this.router.addRoute("add-patient",(()=>{this.requireAuth((()=>this.showAddPatient()))})),this.router.addRoute("queue",(()=>{this.requireAuth((()=>this.showQueue()))})),this.router.setDefaultRoute((()=>{this.isAuthenticated?this.router.navigate("dashboard"):this.router.navigate("login")}))}setupEventListeners(){document.addEventListener("click",(e=>{("logoutBtn"===e.target.id||e.target.closest("#logoutBtn"))&&this.logout()})),document.addEventListener("click",(e=>{const n=e.target.closest(".nav-link");if(n){e.preventDefault(),document.querySelectorAll(".nav-link").forEach((e=>{e.classList.remove("active")})),n.classList.add("active");const t=n.dataset.route;t&&this.router.navigate(t)}})),document.addEventListener("click",(e=>{"modalClose"!==e.target.id&&"modalOverlay"!==e.target.id||this.hideModal(),"modalConfirm"!==e.target.id&&"modalCancel"!==e.target.id||this.hideModal()}))}requireAuth(e){this.isAuthenticated?e():this.router.navigate("login")}start(){this.router.start()}async login(e){this.showLoading();try{const n=await(0,k.loginUser)(e);return localStorage.setItem("authToken",n),this.currentUser={username:e.username,token:n},this.isAuthenticated=!0,this.storage.set("currentUser",this.currentUser),this.hideLoading(),this.showHeader(),this.currentUser}catch(e){throw this.hideLoading(),e}}logout(){this.showModal("Konfirmasi Logout","Apakah Anda yakin ingin keluar dari sistem?",(()=>{this.currentUser=null,this.isAuthenticated=!1,this.storage.remove("currentUser"),localStorage.removeItem("authToken"),this.hideHeader(),this.router.navigate("login")}),!0)}showLogin(){this.hideHeader(),document.getElementById("app-content").innerHTML=w.render(),w.init(this)}showDashboard(){this.showHeader(),document.getElementById("app-content").innerHTML=x.render(),x.init(this)}showFaceRecognition(){this.showHeader(),document.getElementById("app-content").innerHTML=E.render(),E.init(this)}showPatients(){this.showHeader(),document.getElementById("app-content").innerHTML=I.render(),I.init(this),window.patientsComponent=I}async showPatientRecord(){this.showHeader();const e=this.router.getParams().patientId,n=await S.render(e);document.getElementById("app-content").innerHTML=n,await S.init(this,e)}showAddPatient(){this.showHeader(),document.getElementById("app-content").innerHTML=P.render(),P.init(this)}showQueue(){this.showHeader(),document.getElementById("app-content").innerHTML=D.render(),D.init(this)}showHeader(){document.getElementById("header").style.display="block"}hideHeader(){document.getElementById("header").style.display="none"}showLoading(){document.getElementById("loadingSpinner").style.display="flex"}hideLoading(){document.getElementById("loadingSpinner").style.display="none"}showModal(e,n,t=null,a=!1){document.getElementById("modalTitle").textContent=e,document.getElementById("modalMessage").textContent=n;const i=document.getElementById("modalConfirm"),o=document.getElementById("modalCancel"),r=i.cloneNode(!0),s=o.cloneNode(!0);i.parentNode.replaceChild(r,i),o.parentNode.replaceChild(s,o),t&&r.addEventListener("click",t),s.style.display=a?"inline-flex":"none",document.getElementById("modalOverlay").style.display="flex"}hideModal(){document.getElementById("modalOverlay").style.display="none"}showNotification(e,n="info"){const t="error"===n?"Error":"success"===n?"Berhasil":"Informasi";this.showModal(t,e)}}document.addEventListener("DOMContentLoaded",(()=>{window.hospitalApp=new B}))})();